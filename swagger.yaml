openapi: 3.0.0
info:
  title: Claude API 代理服务
  description: |
    提供用户管理、订阅管理、积分计费和 API 请求转发等功能的 Claude API 代理服务。
  version: 1.0.0
  contact:
    email: admin@example.com

servers:
  - url: http://110.42.42.200:9998/api
    description: 本地开发服务器

tags:
  # 用户接口标签
  - name: auth
    description: 用户认证相关接口
  - name: user-subscription
    description: 用户订阅管理接口
  - name: user-credits
    description: 用户积分管理接口
  - name: user-checkin
    description: 用户签到相关接口
  - name: user-devices
    description: 用户设备管理接口
  - name: claude-api
    description: Claude API 代理接口
  - name: public
    description: 公共接口
  - name: oauth
    description: OAuth相关接口
  
  # 管理员接口标签
  - name: admin-users
    description: 管理员用户管理接口
  - name: admin-subscription-plans
    description: 管理员订阅计划管理接口
  - name: admin-activation-codes
    description: 管理员激活码管理接口
  - name: admin-system
    description: 管理员系统配置接口
  - name: admin-announcements
    description: 管理员公告管理接口

paths:
  #============================================
  # 公共接口
  #============================================
  
  /health:
    get:
      tags:
        - public
      summary: 健康检查
      description: 服务健康状态检查
      responses:
        '200':
          description: 服务正常
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: claude-code-api

  /bing:
    get:
      tags:
        - public
      summary: 获取Bing每日图片
      description: 获取Bing搜索引擎的每日背景图片
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    example: https://bing.com/th?id=...
                  title:
                    type: string
                    example: 每日图片标题

  /config:
    get:
      tags:
        - public
      summary: 获取前端配置
      description: 获取前端页面所需的配置信息
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  site_name:
                    type: string
                    example: Claude Code API
                  oauth_enabled:
                    type: boolean
                    example: true
                  registration_enabled:
                    type: boolean
                    example: true

  #============================================
  # 用户接口
  #============================================
  
  #--------------------------------------------
  # 认证接口
  #--------------------------------------------
  /auth/register:
    post:
      tags:
        - auth
      summary: 用户注册
      description: 创建新用户并返回 JWT Token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: user123
                  description: 用户名，长度3-20个字符
                email:
                  type: string
                  format: email
                  example: user@example.com
                  description: 有效的邮箱地址
                password:
                  type: string
                  format: password
                  example: password123
                  description: 密码，至少6个字符
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 注册成功
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: user123
                      email:
                        type: string
                        example: user@example.com
        '400':
          description: 请求格式错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: 用户名或邮箱已存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /auth/login:
    post:
      tags:
        - auth
      summary: 用户登录
      description: 验证用户凭据并返回 JWT Token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 登录成功
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: user123
                      email:
                        type: string
                        example: user@example.com
                      is_admin:
                        type: boolean
                        example: false
        '401':
          description: 邮箱或密码错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /auth/logout:
    post:
      tags:
        - auth
      summary: 用户登出
      description: 使当前 token 失效
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 登出成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 登出成功
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /auth/user:
    get:
      tags:
        - auth
      summary: 获取当前用户信息
      description: 返回当前登录用户的详细信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 1
                      username:
                        type: string
                        example: user123
                      email:
                        type: string
                        example: user@example.com
                      is_admin:
                        type: boolean
                        example: false
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/check-email:
    post:
      tags:
        - auth
      summary: 检查邮箱是否已注册
      description: 检查指定邮箱是否已经注册
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  exists:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 邮箱已注册

  /auth/send-verification-code:
    post:
      tags:
        - auth
      summary: 发送邮箱验证码
      description: 向指定邮箱发送验证码
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: 验证码发送成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 验证码发送成功

  /auth/register-with-code:
    post:
      tags:
        - auth
      summary: 验证码注册
      description: 使用邮箱验证码进行用户注册
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - verification_code
              properties:
                username:
                  type: string
                  example: user123
                email:
                  type: string
                  format: email
                  example: user@example.com
                verification_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 注册成功
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/UserData'

  /auth/login-with-code:
    post:
      tags:
        - auth
      summary: 验证码登录
      description: 使用邮箱验证码进行登录
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - verification_code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                verification_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 登录成功
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/UserData'

  /auth/email-auth:
    post:
      tags:
        - auth
      summary: 邮箱一键登录/注册
      description: 使用邮箱验证码进行一键登录或注册
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - verification_code
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                verification_code:
                  type: string
                  example: "123456"
                username:
                  type: string
                  example: user123
                  description: 注册时使用的用户名（可选）
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 登录成功
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/UserData'

  /auth/check-username:
    post:
      tags:
        - auth
      summary: 检查用户名可用性
      description: 检查指定用户名是否可用
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
              properties:
                username:
                  type: string
                  example: newuser123
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  available:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 用户名可用

  /auth/send-verification-code-settings:
    post:
      tags:
        - auth
      summary: 发送设置页面验证码
      description: 向用户邮箱发送用于修改设置的验证码
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: 验证码发送成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 验证码发送成功

  /auth/change-username:
    post:
      tags:
        - auth
      summary: 修改用户名
      description: 使用验证码修改用户名
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - new_username
                - verification_code
              properties:
                new_username:
                  type: string
                  example: newusername
                verification_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: 用户名修改成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 用户名修改成功

  /auth/change-password:
    post:
      tags:
        - auth
      summary: 修改密码
      description: 使用验证码修改密码
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - new_password
                - verification_code
              properties:
                new_password:
                  type: string
                  format: password
                  example: newpassword123
                verification_code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: 密码修改成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 密码修改成功
  
  #--------------------------------------------
  # OAuth相关接口
  #--------------------------------------------
  /oauth/linux-do/config:
    get:
      tags:
        - oauth
      summary: 获取Linux Do OAuth配置
      description: 获取Linux Do OAuth配置状态
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  enabled:
                    type: boolean
                    example: true
                  client_id:
                    type: string
                    example: your-client-id

  /oauth/linux-do/authorize:
    get:
      tags:
        - oauth
      summary: 生成Linux Do授权URL
      description: 生成Linux Do OAuth授权URL
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  authorize_url:
                    type: string
                    example: https://connect.linux.do/oauth2/authorize?...

  /oauth/linuxdo/temp-user:
    get:
      tags:
        - oauth
      summary: 获取临时用户信息
      description: 获取Linux Do OAuth临时用户信息
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: 临时令牌
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  user_info:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: 123
                      username:
                        type: string
                        example: linuxdo_user
                      name:
                        type: string
                        example: Linux Do User

  /oauth/linuxdo/complete-registration:
    post:
      tags:
        - oauth
      summary: 完成Linux Do注册
      description: 完成Linux Do OAuth注册流程
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - username
              properties:
                token:
                  type: string
                  example: temp-token-123
                username:
                  type: string
                  example: new_username
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/UserData'

  /oauth/linuxdo:
    get:
      tags:
        - oauth
      summary: Linux Do回调处理
      description: Linux Do OAuth回调处理端点
      parameters:
        - name: code
          in: query
          schema:
            type: string
          description: 授权码
        - name: state
          in: query
          schema:
            type: string
          description: 状态参数
      responses:
        '302':
          description: 重定向到前端页面
  
  #--------------------------------------------
  # SSO认证接口
  #--------------------------------------------
  /sso/authorize:
    post:
      tags:
        - auth
      summary: OAuth授权
      description: 为第三方应用创建OAuth授权
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - client_id
                - scope
              properties:
                client_id:
                  type: string
                  example: Duck Code
                scope:
                  type: string
                  example: api
                device_code:
                  type: string
                  example: DEVICE-123456
      responses:
        '200':
          description: 授权成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  expires_in:
                    type: integer
                    example: 86400
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /sso/verify-token:
    post:
      tags:
        - auth
      summary: 验证Token
      description: 验证客户端传入的Token是否有效
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - client_id
                - client_secret
                - token
              properties:
                client_id:
                  type: string
                  example: Duck Code
                client_secret:
                  type: string
                  example: 2935467f5e0e1d383a51a467c9680091dc29015291245dbb6b440adcaf9e1011
                token:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token验证结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  user_id:
                    type: integer
                    example: 1
                  expires_at:
                    type: string
                    format: date-time
                    example: '2024-07-23T16:12:32Z'
        '401':
          description: 无效的客户端凭据
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /sso/verify-code:
    post:
      tags:
        - auth
      summary: 验证设备码
      description: 验证设备授权码
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - client_id
                - client_secret
                - device_code
              properties:
                client_id:
                  type: string
                  example: Duck Code
                client_secret:
                  type: string
                  example: 2935467f5e0e1d383a51a467c9680091dc29015291245dbb6b440adcaf9e1011
                device_code:
                  type: string
                  example: DEVICE-123456
      responses:
        '200':
          description: 设备码验证结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  user_id:
                    type: integer
                    example: 1
                  token:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: 无效的客户端凭据或设备码
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 用户订阅接口
  #--------------------------------------------
  /subscription/active:
    get:
      tags:
        - user-subscription
      summary: 获取活跃订阅
      description: 获取用户当前活跃的订阅信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  subscription:
                    $ref: '#/components/schemas/SubscriptionData'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /subscription/history:
    get:
      tags:
        - user-subscription
      summary: 获取订阅历史
      description: 获取用户的订阅和支付历史
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      $ref: '#/components/schemas/PaymentHistoryData'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /subscription/redeem/preview:
    post:
      tags:
        - user-subscription
      summary: 激活码预检查
      description: 预检查激活码的有效性和详细信息
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - couponCode
              properties:
                couponCode:
                  type: string
                  example: ABCD1234
      responses:
        '200':
          description: 预检查结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  planInfo:
                    type: object
                    properties:
                      title:
                        type: string
                        example: 标准套餐
                      point_amount:
                        type: integer
                        example: 10000
                      validity_days:
                        type: integer
                        example: 30
        '400':
          description: 无效的激活码
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /subscription/redeem:
    post:
      tags:
        - user-subscription
      summary: 兑换激活码
      description: 兑换订阅激活码，获取积分和订阅
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - couponCode
              properties:
                couponCode:
                  type: string
                  example: ABCD1234
      responses:
        '200':
          description: 兑换结果
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  newSubscription:
                    $ref: '#/components/schemas/SubscriptionData'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '400':
          description: 无效的激活码
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 用户积分接口
  #--------------------------------------------
  /credits/balance:
    get:
      tags:
        - user-credits
      summary: 获取积分余额
      description: 获取用户当前的积分余额
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  balance:
                    type: object
                    properties:
                      available:
                        type: integer
                        example: 5000
                      total:
                        type: integer
                        example: 10000
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /credits/model-costs:
    get:
      tags:
        - user-credits
      summary: 获取模型费率
      description: 获取不同模型的积分消耗费率
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  costs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: claude-3-opus-20240229
                        modelName:
                          type: string
                          example: Claude 3 Opus
                        status:
                          type: string
                          example: available
                        costFactor:
                          type: number
                          example: 1.0
                        description:
                          type: string
                          example: 最强大的模型，适合复杂任务
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /credits/pricing-table:
    get:
      tags:
        - user-credits
      summary: 获取定价表
      description: 获取积分套餐的定价信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  plans:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: PLAN-001
                        title:
                          type: string
                          example: 标准套餐
                        price:
                          type: number
                          example: 9.99
                        currency:
                          type: string
                          example: USD
                        point_amount:
                          type: integer
                          example: 10000
                        features:
                          type: array
                          items:
                            type: string
                          example: ["特性1", "特性2"]

  /credits/daily-usage:
    get:
      tags:
        - user-credits
      summary: 获取每日使用统计
      description: 获取用户每日积分使用统计信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  dailyUsage:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                          example: "2024-01-15"
                        usage:
                          type: integer
                          example: 500
                        requests:
                          type: integer
                          example: 25

  #--------------------------------------------
  # 设备管理接口
  #--------------------------------------------
  /devices:
    get:
      tags:
        - user-devices
      summary: 获取设备列表
      description: 获取用户的所有已登录设备
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/Device'
    delete:
      tags:
        - user-devices
      summary: 下线其他设备
      description: 下线除当前设备外的所有其他设备
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 其他设备已下线

  /devices/{deviceId}:
    delete:
      tags:
        - user-devices
      summary: 下线指定设备
      description: 下线指定的设备
      security:
        - BearerAuth: []
      parameters:
        - name: deviceId
          in: path
          required: true
          schema:
            type: string
          description: 设备ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 设备已下线

  /devices/force:
    delete:
      tags:
        - user-devices
      summary: 强制下线所有设备
      description: 强制下线用户的所有设备（包括当前设备）
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 所有设备已强制下线

  /devices/stats:
    get:
      tags:
        - user-devices
      summary: 获取设备统计
      description: 获取用户设备的统计信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    example: 5
                  active:
                    type: integer
                    example: 3
                  lastActive:
                    type: string
                    format: date-time
                    example: '2024-01-15T10:30:00Z'

  /credits/history:
    get:
      tags:
        - user-credits
      summary: 获取积分使用记录
      description: 获取用户的积分使用记录
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: 页码
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 10
          description: 每页记录数
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  history:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "1"
                        description:
                          type: string
                          example: 使用 claude-3-opus 模型，消耗 1000 prompt tokens，500 completion tokens
                        amount:
                          type: integer
                          example: -100
                        timestamp:
                          type: string
                          format: date-time
                          example: '2024-06-23T16:12:32Z'
                        relatedModel:
                          type: string
                          example: claude-3-opus-20240229
                  totalPages:
                    type: integer
                    example: 5
                  currentPage:
                    type: integer
                    example: 1
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # Claude API 代理接口
  #--------------------------------------------
  /claude:
    post:
      tags:
        - claude-api
      summary: Claude API代理
      description: 转发请求到Claude API，并处理积分扣费
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 与Claude API兼容的请求体
      responses:
        '200':
          description: Claude API的响应
          content:
            application/json:
              schema:
                type: object
                description: Claude API的响应体
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          description: 积分不足
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /claude/{path}:
    parameters:
      - name: path
        in: path
        required: true
        schema:
          type: string
        description: Claude API的子路径
    any:
      tags:
        - claude-api
      summary: Claude API任意路径代理
      description: 转发请求到Claude API的任意路径
      security:
        - BearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: 与Claude API兼容的请求体
      responses:
        '200':
          description: Claude API的响应
          content:
            application/json:
              schema:
                type: object
                description: Claude API的响应体
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '402':
          description: 积分不足
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: 服务器错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 公告接口
  #--------------------------------------------
  /announcements:
    get:
      tags:
        - public
      summary: 获取公告
      description: 获取系统公告信息（公共接口，无需认证）
      parameters:
        - name: language
          in: query
          schema:
            type: string
            default: zh
          description: 语言代码
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  announcements:
                    type: array
                    items:
                      $ref: '#/components/schemas/Announcement'
  
  #============================================
  # 管理员接口
  #============================================
  
  #--------------------------------------------
  # 用户管理接口
  #--------------------------------------------
  /admin/users:
    get:
      tags:
        - admin-users
      summary: 获取用户列表
      description: 管理员获取所有用户的列表
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: 页码
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
          description: 每页记录数
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  total:
                    type: integer
                    example: 100
                  page:
                    type: integer
                    example: 1
                  page_size:
                    type: integer
                    example: 10
                  total_pages:
                    type: integer
                    example: 10
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /admin/users/{id}:
    put:
      tags:
        - admin-users
      summary: 更新用户
      description: 管理员更新用户信息
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                is_admin:
                  type: boolean
                  example: false
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User updated successfully
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - admin-users
      summary: 删除用户
      description: 管理员删除用户
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User deleted successfully
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 用户不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 订阅计划管理接口
  #--------------------------------------------
  /admin/subscription-plans:
    get:
      tags:
        - admin-subscription-plans
      summary: 获取订阅计划列表
      description: 管理员获取所有订阅计划
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: 页码
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
          description: 每页记录数
        - name: active
          in: query
          schema:
            type: string
            enum: [true, false]
          description: 是否筛选活跃的计划
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SubscriptionPlan'
                  total:
                    type: integer
                    example: 100
                  page:
                    type: integer
                    example: 1
                  page_size:
                    type: integer
                    example: 10
                  total_pages:
                    type: integer
                    example: 10
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - admin-subscription-plans
      summary: 创建订阅计划
      description: 管理员创建新的订阅计划
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionPlanCreate'
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionPlan'
        '400':
          description: 请求格式错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /admin/subscription-plans/{id}:
    put:
      tags:
        - admin-subscription-plans
      summary: 更新订阅计划
      description: 管理员更新订阅计划
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 订阅计划ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionPlanUpdate'
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Subscription plan updated successfully
        '400':
          description: 请求格式错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 订阅计划不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
        - admin-subscription-plans
      summary: 删除订阅计划
      description: 管理员删除订阅计划
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 订阅计划ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Subscription plan deleted successfully
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 订阅计划不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 激活码管理接口
  #--------------------------------------------
  /admin/activation-codes:
    get:
      tags:
        - admin-activation-codes
      summary: 获取激活码列表
      description: 管理员获取所有激活码
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: 页码
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
          description: 每页记录数
        - name: status
          in: query
          schema:
            type: string
            enum: [unused, used, expired]
          description: 激活码状态
        - name: batch_number
          in: query
          schema:
            type: string
          description: 批次号
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ActivationCode'
                  total:
                    type: integer
                    example: 100
                  page:
                    type: integer
                    example: 1
                  page_size:
                    type: integer
                    example: 10
                  total_pages:
                    type: integer
                    example: 10
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
        - admin-activation-codes
      summary: 创建激活码
      description: 管理员批量创建激活码
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - count
                - subscription_plan_id
              properties:
                count:
                  type: integer
                  minimum: 1
                  maximum: 1000
                  example: 10
                  description: 要生成的激活码数量
                subscription_plan_id:
                  type: integer
                  example: 1
                  description: 关联的订阅计划ID
                expires_at:
                  type: string
                  format: date-time
                  example: '2024-12-31T23:59:59Z'
                  description: 激活码过期时间
                batch_number:
                  type: string
                  example: BATCH-001
                  description: 批次号
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Activation codes created successfully
                  count:
                    type: integer
                    example: 10
                  batch_number:
                    type: string
                    example: BATCH-001
                  plan_id:
                    type: string
                    example: PLAN-001
                  plan_title:
                    type: string
                    example: 标准套餐
        '400':
          description: 请求格式错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /admin/activation-codes/{id}:
    delete:
      tags:
        - admin-activation-codes
      summary: 删除激活码
      description: 管理员删除激活码
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 激活码ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Activation code deleted successfully
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 激活码不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  #--------------------------------------------
  # 系统配置接口
  #--------------------------------------------
  /admin/system-configs:
    get:
      tags:
        - admin-system
      summary: 获取系统配置
      description: 管理员获取所有系统配置
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SystemConfig'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
                
  /admin/system-config:
    put:
      tags:
        - admin-system
      summary: 更新系统配置
      description: 管理员更新系统配置
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - config_key
                - config_value
              properties:
                config_key:
                  type: string
                  example: prompt_multiplier
                config_value:
                  type: string
                  example: "5"
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: System config updated successfully
        '400':
          description: 请求格式错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 禁止访问
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 配置不存在
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  #--------------------------------------------
  # 管理员数据看板接口
  #--------------------------------------------
  /admin/dashboard:
    get:
      tags:
        - admin-system
      summary: 管理员仪表板
      description: 获取管理员仪表板数据
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 1000
                      active:
                        type: integer
                        example: 800
                  credits:
                    type: object
                    properties:
                      totalUsed:
                        type: integer
                        example: 500000
                      totalIssued:
                        type: integer
                        example: 1000000
                  subscriptions:
                    type: object
                    properties:
                      active:
                        type: integer
                        example: 200
                      expired:
                        type: integer
                        example: 50

  #--------------------------------------------
  # 管理员用户状态管理接口
  #--------------------------------------------
  /admin/users/{id}/status:
    put:
      tags:
        - admin-users
      summary: 切换用户状态
      description: 启用或禁用用户账户
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [active, disabled]
                  example: active
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 用户状态已更新

  /admin/users/{id}/subscriptions:
    get:
      tags:
        - admin-users
      summary: 获取用户订阅
      description: 获取指定用户的订阅信息
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  subscriptions:
                    type: array
                    items:
                      $ref: '#/components/schemas/SubscriptionData'

  /admin/users/{id}/subscriptions/{subscription_id}/limit:
    put:
      tags:
        - admin-users
      summary: 更新用户订阅限制
      description: 更新指定用户订阅的使用限制
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
        - name: subscription_id
          in: path
          required: true
          schema:
            type: integer
          description: 订阅ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                daily_limit:
                  type: integer
                  example: 1000
                monthly_limit:
                  type: integer
                  example: 30000
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 订阅限制已更新

  /admin/users/{id}/gift:
    post:
      tags:
        - admin-users
      summary: 赠送用户订阅
      description: 管理员向用户赠送订阅或积分
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 用户ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                gift_type:
                  type: string
                  enum: [subscription, credits]
                  example: credits
                amount:
                  type: integer
                  example: 1000
                reason:
                  type: string
                  example: 活动赠送
      responses:
        '200':
          description: 赠送成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 赠送成功

  #--------------------------------------------
  # 管理员赠送记录管理接口
  #--------------------------------------------
  /admin/gift-records:
    get:
      tags:
        - admin-users
      summary: 获取赠送记录
      description: 获取管理员的赠送记录
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        user_id:
                          type: integer
                          example: 123
                        gift_type:
                          type: string
                          example: credits
                        amount:
                          type: integer
                          example: 1000
                        reason:
                          type: string
                          example: 活动赠送
                        created_at:
                          type: string
                          format: date-time

  #--------------------------------------------
  # 管理员激活码每日限制接口
  #--------------------------------------------
  /admin/activation-codes/{id}/daily-limit:
    get:
      tags:
        - admin-activation-codes
      summary: 获取激活码每日限制
      description: 获取指定激活码的每日使用限制
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 激活码ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  daily_limit:
                    type: integer
                    example: 100
    put:
      tags:
        - admin-activation-codes
      summary: 更新激活码每日限制
      description: 更新指定激活码的每日使用限制
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 激活码ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - daily_limit
              properties:
                daily_limit:
                  type: integer
                  example: 100
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 每日限制已更新

  /admin/activation-codes/ban:
    post:
      tags:
        - admin-activation-codes
      summary: 封禁激活码
      description: 封禁用户的指定激活码并冻结相关积分
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - activation_code
                - reason
              properties:
                user_id:
                  type: integer
                  example: 123
                activation_code:
                  type: string
                  example: ABCD-EFGH-IJKL-MNOP
                reason:
                  type: string
                  example: 违规使用
      responses:
        '200':
          description: 封禁成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 激活码封禁成功

  /admin/activation-codes/ban-preview:
    post:
      tags:
        - admin-activation-codes
      summary: 预览封禁影响
      description: 预览封禁激活码会对用户造成的影响
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
                - activation_code
              properties:
                user_id:
                  type: integer
                  example: 123
                activation_code:
                  type: string
                  example: ABCD-EFGH-IJKL-MNOP
      responses:
        '200':
          description: 预览成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  frozen_points:
                    type: integer
                    example: 5000
                  remaining_points:
                    type: integer
                    example: 3000
                  affected_benefits:
                    type: object
                    example: {"daily_max_points": 1000}

  /admin/frozen-records:
    get:
      tags:
        - admin-activation-codes
      summary: 获取冻结记录列表
      description: 获取所有激活码冻结记录
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
        - name: user_id
          in: query
          schema:
            type: integer
          description: 过滤指定用户
        - name: status
          in: query
          schema:
            type: string
            enum: [frozen]
          description: 记录状态
        - name: activation_code
          in: query
          schema:
            type: string
          description: 激活码过滤
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FrozenRecord'
                  total:
                    type: integer
                    example: 50
                  page:
                    type: integer
                    example: 1
                  page_size:
                    type: integer
                    example: 10

  /admin/frozen-records/{id}:
    get:
      tags:
        - admin-activation-codes
      summary: 获取冻结记录详情
      description: 获取指定冻结记录的详细信息
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 冻结记录ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FrozenRecord'

  #--------------------------------------------
  # 管理员公告管理接口
  #--------------------------------------------
  /admin/announcements:
    get:
      tags:
        - admin-announcements
      summary: 获取公告列表
      description: 管理员获取所有公告
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Announcement'
                  total:
                    type: integer
                    example: 50
    post:
      tags:
        - admin-announcements
      summary: 创建公告
      description: 管理员创建新公告
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
                - type
              properties:
                title:
                  type: string
                  example: 系统升级通知
                description:
                  type: string
                  example: 系统将于明天进行升级维护
                type:
                  type: string
                  enum: [info, warning, error, success]
                  example: info
                language:
                  type: string
                  default: zh
                  example: zh
      responses:
        '201':
          description: 创建成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Announcement'

  /admin/announcements/{id}:
    put:
      tags:
        - admin-announcements
      summary: 更新公告
      description: 管理员更新公告
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 公告ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: 系统升级通知
                description:
                  type: string
                  example: 系统将于明天进行升级维护
                type:
                  type: string
                  enum: [info, warning, error, success]
                  example: info
                language:
                  type: string
                  example: zh
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 公告已更新
    delete:
      tags:
        - admin-announcements
      summary: 删除公告
      description: 管理员删除公告
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: 公告ID
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: 公告已删除

  #--------------------------------------------
  # 签到相关接口
  #--------------------------------------------
  /checkin/status:
    get:
      tags:
        - user-checkin
      summary: 获取签到状态
      description: 获取用户当前签到状态和奖励信息
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckinStatusResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /checkin:
    post:
      tags:
        - user-checkin
      summary: 执行每日签到
      description: 执行每日签到并获得积分奖励
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 签到结果
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckinResponse'
        '401':
          description: 未授权
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      
  schemas:
    UserData:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: user123
        email:
          type: string
          example: user@example.com
        is_admin:
          type: boolean
          example: false

    Device:
      type: object
      properties:
        id:
          type: string
          example: device-12345
        device_name:
          type: string
          example: iPhone 14
        device_type:
          type: string
          example: mobile
        ip:
          type: string
          example: 192.168.1.100
        location:
          type: string
          example: 北京, 中国
        source:
          type: string
          example: web
        created_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        last_active:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        expires_at:
          type: string
          format: date-time
          example: '2024-02-15T10:30:00Z'
        is_current:
          type: boolean
          example: true

    Announcement:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: 系统升级通知
        description:
          type: string
          example: 系统将于明天进行升级维护
        type:
          type: string
          enum: [info, warning, error, success]
          example: info
        language:
          type: string
          example: zh
        created_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: Unauthorized access
        success:
          type: boolean
          example: false
        message:
          type: string
          example: 错误消息
          
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        email:
          type: string
          example: user@example.com
        username:
          type: string
          example: user123
        is_admin:
          type: boolean
          example: false
        degradation_guaranteed:
          type: integer
          example: 3
        degradation_source:
          type: string
          example: subscription
        degradation_locked:
          type: boolean
          example: false
        degradation_counter:
          type: integer
          example: 0
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
          
    SubscriptionPlan:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: 标准套餐
        description:
          type: string
          example: 包含10000积分的标准套餐
        point_amount:
          type: integer
          example: 10000
        price:
          type: number
          format: float
          example: 9.99
        currency:
          type: string
          example: USD
        validity_days:
          type: integer
          example: 30
        degradation_guaranteed:
          type: integer
          example: 3
        daily_checkin_points:
          type: integer
          example: 10
          description: 每日签到奖励积分（最低值）
        daily_checkin_points_max:
          type: integer
          example: 50
          description: 每日签到奖励积分（最高值）
        features:
          type: string
          example: '["特性1", "特性2"]'
        active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
          
    SubscriptionPlanCreate:
      type: object
      required:
        - title
        - point_amount
        - price
        - validity_days
      properties:
        title:
          type: string
          example: 标准套餐
        description:
          type: string
          example: 包含10000积分的标准套餐
        point_amount:
          type: integer
          example: 10000
        price:
          type: number
          format: float
          example: 9.99
        currency:
          type: string
          example: USD
        validity_days:
          type: integer
          example: 30
        degradation_guaranteed:
          type: integer
          example: 3
        daily_checkin_points:
          type: integer
          example: 10
          description: 每日签到奖励积分（最低值）
        daily_checkin_points_max:
          type: integer
          example: 50
          description: 每日签到奖励积分（最高值）
        features:
          type: string
          example: '["特性1", "特性2"]'
        active:
          type: boolean
          example: true
          
    SubscriptionPlanUpdate:
      type: object
      properties:
        title:
          type: string
          example: 标准套餐
        description:
          type: string
          example: 包含10000积分的标准套餐
        point_amount:
          type: integer
          example: 10000
        price:
          type: number
          format: float
          example: 9.99
        currency:
          type: string
          example: USD
        validity_days:
          type: integer
          example: 30
        degradation_guaranteed:
          type: integer
          example: 3
        daily_checkin_points:
          type: integer
          example: 10
          description: 每日签到奖励积分（最低值）
        daily_checkin_points_max:
          type: integer
          example: 50
          description: 每日签到奖励积分（最高值）
        features:
          type: string
          example: '["特性1", "特性2"]'
        active:
          type: boolean
          example: true
          
    ActivationCode:
      type: object
      properties:
        id:
          type: integer
          example: 1
        code:
          type: string
          example: ABCD-EFGH-IJKL-MNOP
        subscription_plan_id:
          type: integer
          example: 1
        plan:
          $ref: '#/components/schemas/SubscriptionPlan'
        status:
          type: string
          enum: [unused, used, expired]
          example: unused
        used_by_user_id:
          type: integer
          nullable: true
          example: null
        used_by:
          type: object
          nullable: true
          properties:
            id:
              type: integer
              example: 2
            username:
              type: string
              example: user123
            email:
              type: string
              example: user@example.com
        used_at:
          type: string
          format: date-time
          nullable: true
          example: null
        expires_at:
          type: string
          format: date-time
          nullable: true
          example: null
        batch_number:
          type: string
          example: BATCH-001
        created_at:
          type: string
          format: date-time
          
    SubscriptionData:
      type: object
      properties:
        id:
          type: string
          example: SUB-1-1234567890
        plan:
          type: object
          properties:
            id:
              type: string
              example: PLAN-001
            name:
              type: string
              example: 标准套餐
            currency:
              type: string
              example: USD
            features:
              type: array
              items:
                type: string
              example: ["特性1", "特性2"]
        status:
          type: string
          example: active
        currentPeriodEnd:
          type: string
          format: date-time
          example: '2024-07-23T16:12:32Z'
        cancelAtPeriodEnd:
          type: boolean
          example: false
          
    PaymentHistoryData:
      type: object
      properties:
        id:
          type: string
          example: "1"
        planName:
          type: string
          example: 标准套餐
        amount:
          type: number
          format: float
          example: 9.99
        currency:
          type: string
          example: USD
        date:
          type: string
          format: date-time
          example: '2024-06-23T16:12:32Z'
        status:
          type: string
          example: paid
        invoiceURL:
          type: string
          example: https://example.com/invoice/123
          
    SystemConfig:
      type: object
      properties:
        id:
          type: integer
          example: 1
        config_key:
          type: string
          example: prompt_multiplier
        config_value:
          type: string
          example: "5"
        description:
          type: string
          example: 提示token倍率
        updated_at:
          type: string
          format: date-time

    CheckinPointsRange:
      type: object
      properties:
        minPoints:
          type: integer
          example: 10
          description: 最低积分奖励
        maxPoints:
          type: integer
          example: 50
          description: 最高积分奖励
        hasValid:
          type: boolean
          example: true
          description: 是否有有效的签到配置

    CheckinStatusResponse:
      type: object
      properties:
        canCheckin:
          type: boolean
          example: true
          description: 是否可以签到
        todayChecked:
          type: boolean
          example: false
          description: 今天是否已签到
        lastCheckinDate:
          type: string
          example: "2024-01-15"
          description: 最后签到日期 (YYYY-MM-DD)
        pointsRange:
          $ref: '#/components/schemas/CheckinPointsRange'

    CheckinResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
          description: 签到是否成功
        message:
          type: string
          example: "签到成功！获得 10 积分奖励"
          description: 响应消息
        rewardPoints:
          type: integer
          example: 10
          description: 获得的奖励积分

    FrozenRecord:
      type: object
      properties:
        id:
          type: integer
          example: 1
        user_id:
          type: integer
          example: 123
        banned_activation_code:
          type: string
          example: ABCD-EFGH-IJKL-MNOP
        banned_code_id:
          type: integer
          example: 456
        frozen_points:
          type: integer
          example: 5000
        frozen_benefits:
          type: string
          example: '{"daily_max_points": 1000}'
        before_ban_wallet_state:
          type: string
          example: '{"total_points": 10000}'
        before_ban_benefits:
          type: string
          example: '{"degradation_guaranteed": 3}'
        calculation_method:
          type: string
          example: 虚拟消费计算结果...
        estimated_usage:
          type: integer
          example: 2000
        ban_reason:
          type: string
          example: 违规使用
        admin_user_id:
          type: integer
          example: 1
        status:
          type: string
          enum: [frozen]
          example: frozen
        created_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        updated_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        user:
          type: object
          properties:
            id:
              type: integer
              example: 123
            username:
              type: string
              example: user123
            email:
              type: string
              example: user@example.com
        admin_user:
          type: object
          properties:
            id:
              type: integer
              example: 1
            username:
              type: string
              example: admin