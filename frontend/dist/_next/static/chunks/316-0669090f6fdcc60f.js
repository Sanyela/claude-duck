"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[316],{3133:(e,t,r)=>{r.d(t,{Gq:()=>i,J2:()=>s,Ro:()=>c,Sr:()=>v,bS:()=>u,e:()=>d,iD:()=>n,rj:()=>o,ug:()=>l});var a=r(65900);let s=async e=>{try{return(await a.E.post("/auth/send-verification-code",e)).data}catch(e){var t,r;return console.error("发送验证码失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"发送验证码失败，请稍后再试"}}},o=async e=>{try{return(await a.E.post("/auth/register-with-code",e)).data}catch(e){var t,r;return console.error("注册请求失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"注册失败，请稍后再试"}}},n=async e=>{try{return(await a.E.post("/auth/login",e)).data}catch(e){var t,r;return console.error("登录请求失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"邮箱或密码错误"}}},l=async()=>{try{let e=await a.E.get("/auth/user");if(e.data&&e.data.user)return{success:!0,user:e.data.user};return{success:!1,message:"用户信息格式错误"}}catch(r){var e,t;return console.error("获取用户信息失败:",r),{success:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"获取用户信息失败"}}},i=async e=>{try{let t=await a.E.post("/sso/authorize",{client_id:e.client_id,redirect_uri:e.redirect_uri,state:e.state,device_flow:e.device_flow||!1});return{success:!0,...t.data}}catch(e){var t,r,s,o;return console.error("OAuth授权失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||(null===(o=e.response)||void 0===o?void 0:null===(s=o.data)||void 0===s?void 0:s.error)||"授权失败"}}},u=async e=>{try{return(await a.E.post("/auth/email-auth",e)).data}catch(e){var t,r;return console.error("邮箱验证码认证失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"认证失败，请稍后再试"}}},c=async e=>{try{return(await a.E.post("/auth/check-email",e)).data}catch(e){var t,r;return console.error("检查邮箱失败:",e),{success:!1,user_exists:!1,action_type:"register",message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"检查邮箱失败，请稍后再试"}}},d=async()=>{try{return(await a.E.get("/oauth/linux-do/config")).data}catch(r){var e,t;return console.error("获取Linux Do配置失败:",r),{success:!1,available:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"获取配置失败"}}},v=async()=>{try{return(await a.E.get("/oauth/linux-do/authorize")).data}catch(r){var e,t;return console.error("生成Linux Do授权URL失败:",r),{success:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"生成授权URL失败"}}}},5160:(e,t,r)=>{r.d(t,{$:()=>u,r:()=>i});var a=r(58081),s=r(82149),o=r(18050),n=r(23484),l=r(87687);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),u=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:u=!1,...c}=e,d=u?o.DX:"button";return(0,a.jsx)(d,{className:(0,l.cn)(i({variant:s,size:n,className:r})),ref:t,...c})});u.displayName="Button"},32706:(e,t,r)=>{r.d(t,{A:()=>u,AuthProvider:()=>i});var a=r(58081),s=r(82149),o=r(3133),n=r(19651);let l=(0,s.createContext)({user:null,isAuthenticated:!1,isLoading:!0,login:()=>{},logout:()=>{},refreshUserInfo:async()=>{}}),i=e=>{let{children:t}=e;(0,s.useId)();let[r,i]=(0,s.useState)(null),[u,c]=(0,s.useState)(!0),[d,v]=(0,s.useState)(!1),g=(0,n.useRouter)(),m=()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null),g.push("/login")},f=async()=>{try{c(!0);let e=await (0,o.ug)();if(e.success&&e.user)i(e.user),localStorage.setItem("user_data",JSON.stringify(e.user));else throw Error("获取用户信息失败")}catch(e){console.error("刷新用户信息失败:",e),m()}finally{c(!1)}};return(0,s.useEffect)(()=>{!d&&(async()=>{c(!0);try{let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");if(e&&t){i(JSON.parse(t));let e=await (0,o.ug)();e.success&&e.user?(i(e.user),localStorage.setItem("user_data",JSON.stringify(e.user))):(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null))}}catch(e){console.error("初始化认证状态失败:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null)}finally{c(!1),v(!0)}})()},[d]),(0,s.useEffect)(()=>{},[]),(0,a.jsx)(l.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:u,login:(e,t)=>{localStorage.setItem("auth_token",e),localStorage.setItem("user_data",JSON.stringify(t)),i(t)},logout:m,refreshUserInfo:f},children:t})},u=()=>(0,s.useContext)(l)},65900:(e,t,r)=>{r.d(t,{E:()=>a});let a=r(26807).A.create({baseURL:(()=>{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://localhost:9998/api":"www.duckcode.top"===e?"https://api.duckcode.top/api":"/api"})(),timeout:3e5,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("auth_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),a.interceptors.response.use(e=>e,e=>{let{response:t}=e;return t&&401===t.status&&(console.warn("登录已过期，请重新登录"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.pathname.includes("/login")||(window.location.href="/login")),Promise.reject(e)})},86810:(e,t,r)=>{r.d(t,{BT:()=>u,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>l,wL:()=>d});var a=r(58081),s=r(82149),o=r(87687);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...s})});l.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});i.displayName="CardTitle";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...s})});u.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...s})});d.displayName="CardFooter"},87687:(e,t,r)=>{r.d(t,{cn:()=>o});var a=r(76522),s=r(14483);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}}}]);