(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[826],{18050:(e,t,r)=>{"use strict";r.d(t,{DX:()=>o,Dc:()=>d,TL:()=>n});var a=r(82149),s=r(67351),l=r(58081);function n(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:r,...l}=e;if(a.isValidElement(r)){var n;let e,o;let i=(n=r,(o=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(o=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),d=function(e,t){let r={...t};for(let a in t){let s=e[a],l=t[a];/^on[A-Z]/.test(a)?s&&l?r[a]=(...e)=>{let t=l(...e);return s(...e),t}:s&&(r[a]=s):"style"===a?r[a]={...s,...l}:"className"===a&&(r[a]=[s,l].filter(Boolean).join(" "))}return{...e,...r}}(l,r.props);return r.type!==a.Fragment&&(d.ref=t?(0,s.t)(t,i):i),a.cloneElement(r,d)}return a.Children.count(r)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=a.forwardRef((e,r)=>{let{children:s,...n}=e,o=a.Children.toArray(s),i=o.find(c);if(i){let e=i.props.children,s=o.map(t=>t!==i?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,l.jsx)(t,{...n,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,s):null})}return(0,l.jsx)(t,{...n,ref:r,children:s})});return r.displayName=`${e}.Slot`,r}var o=n("Slot"),i=Symbol("radix.slottable");function d(e){let t=({children:e})=>(0,l.jsx)(l.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=i,t}function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===i}},23484:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var a=r(76522);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=a.$,n=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return l(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:n,defaultVariants:o}=t,i=Object.keys(n).map(e=>{let t=null==r?void 0:r[e],a=null==o?void 0:o[e];if(null===t)return null;let l=s(t)||s(a);return n[e][l]}),d=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return l(e,i,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...d}[t]):({...o,...d})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},50499:(e,t,r)=>{Promise.resolve().then(r.bind(r,60785))},51018:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(82149);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:d="",children:c,iconNode:x,...u}=e;return(0,a.createElement)("svg",{ref:t,...n,width:s,height:s,stroke:r,strokeWidth:i?24*Number(o)/Number(s):o,className:l("lucide",d),...u},[...x.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),i=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:i,...d}=r;return(0,a.createElement)(o,{ref:n,iconNode:t,className:l("lucide-".concat(s(e)),i),...d})});return r.displayName="".concat(e),r}},59921:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(51018).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},60785:(e,t,r)=>{"use strict";r.d(t,{AuthorizeFlow:()=>k});var a=r(58081),s=r(5160),l=r(86810),n=r(80900),o=r(19651),i=r(82149),d=r(59921),c=r(51018);let x=(0,c.A)("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var u=r(75283);let m=(0,c.A)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var h=r(32706),p=r(3133),f=r(97004);function k(){let e=(0,o.useSearchParams)(),{user:t,isAuthenticated:r}=(0,h.A)(),[c,k]=(0,i.useState)(""),[b,y]=(0,i.useState)(""),[g,w]=(0,i.useState)(""),[j,v]=(0,i.useState)(!1),[N,C]=(0,i.useState)(""),[A,_]=(0,i.useState)(""),[S,R]=(0,i.useState)(""),[E,T]=(0,i.useState)(!1),[O,$]=(0,i.useState)(!1),[B,L]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{k(e.get("client_id")||"示例应用"),y(e.get("redirect_uri")||""),w(e.get("state")||""),v("true"===e.get("device_flow"))},[e]),!r)return(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)(l.aR,{className:"text-center",children:[(0,a.jsx)(d.A,{className:"mx-auto h-10 w-10 text-yellow-500"}),(0,a.jsx)(l.ZB,{className:"text-2xl text-slate-900 dark:text-slate-100",children:"需要登录"}),(0,a.jsx)(l.BT,{className:"text-slate-600 dark:text-slate-400",children:"请先登录您的账户以完成OAuth授权。"})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)(s.$,{onClick:()=>window.location.href="/login",className:"w-full bg-sky-500 hover:bg-sky-600 text-white",children:"前往登录"})})]});let W=async()=>{T(!0),R(""),C(""),_(""),L(!1);try{let e=await (0,p.Gq)({client_id:c,redirect_uri:b,response_type:"code",scope:"read",state:g,device_flow:j});if(e.success){if(j)C(e.code);else if(_(e.token),b)try{let t=new URL(b);t.searchParams.set("token",e.token),g&&t.searchParams.set("state",g),window.opener&&window.opener.postMessage({type:"oauth_callback",success:!0,data:{token:e.token,state:g}},new URL(b).origin),window.location.href=t.toString()}catch(e){console.error("重定向失败:",e),R("重定向失败。请手动复制 Token。"),L(!0)}else R("缺少 redirect_uri，无法自动重定向。"),L(!0)}else R(e.message||"授权失败，请重试。")}catch(e){console.error("授权请求失败:",e),R("授权请求失败，请重试。")}finally{T(!1)}},Z=async()=>{if(N)try{await (0,f.l)(N)?($(!0),setTimeout(()=>$(!1),2e3)):alert("无法复制授权码，请手动复制。")}catch(e){console.error("无法复制授权码: ",e),alert("无法复制授权码，请手动复制。")}};return N?(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)(l.aR,{className:"text-center",children:[(0,a.jsx)(x,{className:"mx-auto h-10 w-10 text-green-500"}),(0,a.jsx)(l.ZB,{className:"text-2xl text-slate-900 dark:text-slate-100",children:"授权码已生成"}),(0,a.jsxs)(l.BT,{className:"text-slate-600 dark:text-slate-400",children:["请复制以下授权码并粘贴到您的 ",j?"CLI/终端应用":"应用"," 中："]})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.p,{readOnly:!0,value:N,className:"text-lg font-mono p-4 pr-12 text-center bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-200 border-slate-300 dark:border-slate-600"}),(0,a.jsxs)(s.$,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-sky-500 dark:text-slate-400 dark:hover:text-sky-400",onClick:Z,children:[(0,a.jsx)(u.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"复制授权码"})]})]}),O&&(0,a.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400 text-center",children:"授权码已复制到剪贴板！"}),(0,a.jsx)("p",{className:"text-xs text-slate-500 dark:text-slate-400 text-center",children:"此授权码是一次性的，请妥善保管。"})]})]}):B&&A?(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)(l.aR,{className:"text-center",children:[(0,a.jsx)(d.A,{className:"mx-auto h-10 w-10 text-yellow-500"}),(0,a.jsx)(l.ZB,{className:"text-2xl text-slate-900 dark:text-slate-100",children:"重定向可能失败"}),(0,a.jsx)(l.BT,{className:"text-slate-600 dark:text-slate-400",children:"自动重定向似乎未成功。请手动复制以下 Token 并粘贴到您的应用中，或尝试通过以下链接访问："})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.p,{readOnly:!0,value:A,className:"text-sm font-mono p-3 pr-12 bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-200 border-slate-300 dark:border-slate-600 break-all"}),(0,a.jsxs)(s.$,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 hover:text-sky-500 dark:text-slate-400 dark:hover:text-sky-400",onClick:async()=>{await (0,f.l)(A)?alert("Token 已复制!"):alert("无法复制Token，请手动复制。")},children:[(0,a.jsx)(u.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"sr-only",children:"复制Token"})]})]}),b&&(0,a.jsx)(s.$,{variant:"outline",className:"w-full border-slate-300 text-slate-700 hover:bg-slate-100 dark:bg-slate-700 dark:border-slate-600 dark:hover:bg-slate-600 dark:text-slate-50",asChild:!0,children:(0,a.jsxs)("a",{href:"".concat(b,"?token=").concat(encodeURIComponent(A),"&state=").concat(encodeURIComponent(g)),target:"_blank",rel:"noopener noreferrer",children:["尝试手动打开回调链接 ",(0,a.jsx)(m,{className:"ml-2 h-4 w-4"})]})}),S&&(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400 text-center",children:S})]})]}):(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(x,{className:"mx-auto h-10 w-10 text-sky-500"}),(0,a.jsx)(l.ZB,{className:"text-center text-2xl text-slate-900 dark:text-slate-100",children:"授权请求"}),(0,a.jsxs)(l.BT,{className:"text-center text-slate-600 dark:text-slate-400",children:["应用 ",(0,a.jsx)("strong",{className:"text-sky-400",children:c})," 请求访问您的账户。"]})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:"此应用将能够："}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm text-slate-600 dark:text-slate-400",children:[(0,a.jsx)("li",{children:"读取您的基本用户信息"}),(0,a.jsx)("li",{children:"代表您执行操作"})]}),j&&(0,a.jsx)("div",{className:"rounded-md border border-yellow-500 bg-yellow-50 p-3 dark:bg-yellow-900/30 dark:border-yellow-700",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,a.jsx)(d.A,{className:"inline h-4 w-4 mr-1"}),"您正在使用设备流程。授权后，您将获得一个授权码，需要手动输入到您的设备或应用中。"]})}),t&&(0,a.jsx)("div",{className:"rounded-md border border-blue-500 bg-blue-50 p-3 dark:bg-blue-900/30 dark:border-blue-700",children:(0,a.jsxs)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["当前登录用户：",(0,a.jsx)("strong",{children:t.username?t.username:t.email||"未知用户"})]})}),S&&(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:S})]}),(0,a.jsxs)(l.wL,{className:"flex flex-col sm:flex-row gap-2",children:[(0,a.jsx)(s.$,{onClick:W,className:"w-full sm:w-auto flex-1 bg-sky-500 hover:bg-sky-600 text-white dark:text-slate-900",disabled:E,children:E?"处理中...":"授权"}),(0,a.jsx)(s.$,{onClick:()=>{if(b){let e=new URL(b);e.searchParams.set("error","access_denied"),g&&e.searchParams.set("state",g),window.location.href=e.toString()}else R("授权已拒绝。您可以关闭此页面。")},variant:"outline",className:"w-full sm:w-auto flex-1 border-slate-300 text-slate-700 hover:bg-slate-100 dark:bg-slate-700 dark:border-slate-600 dark:hover:bg-slate-600 dark:text-slate-50",disabled:E,children:"拒绝"})]})]})}},67351:(e,t,r)=>{"use strict";r.d(t,{s:()=>n,t:()=>l});var a=r(82149);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function l(...e){return t=>{let r=!1,a=e.map(e=>{let a=s(e,t);return r||"function"!=typeof a||(r=!0),a});if(r)return()=>{for(let t=0;t<a.length;t++){let r=a[t];"function"==typeof r?r():s(e[t],null)}}}}function n(...e){return a.useCallback(l(...e),e)}},75283:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(51018).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},80900:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var a=r(58081),s=r(82149),l=r(87687);let n=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},97004:(e,t,r)=>{"use strict";r.d(t,{l:()=>a});let a=async e=>{try{if("undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();let r=document.execCommand("copy");return document.body.removeChild(t),r}catch(e){return console.error("复制失败:",e),!1}}}},e=>{var t=t=>e(e.s=t);e.O(0,[590,807,316,497,954,358],()=>t(50499)),_N_E=e.O()}]);