(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{4523:(e,s,t)=>{Promise.resolve().then(t.bind(t,18413)),Promise.resolve().then(t.bind(t,54271))},16228:(e,s,t)=>{"use strict";t.d(s,{A0:()=>d,BF:()=>i,Hj:()=>o,XI:()=>n,nA:()=>m,nd:()=>c});var a=t(58081),r=t(82149),l=t(87687);let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",t),...r})})});n.displayName="Table";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",t),...r})});d.displayName="TableHeader";let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",t),...r})});i.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});o.displayName="TableRow";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});c.displayName="TableHead";let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});m.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption"},18413:(e,s,t)=>{"use strict";t.d(s,{CreditsContent:()=>F});var a=t(58081),r=t(82149),l=t(5160),n=t(86810),d=t(16228),i=t(89181),o=t(85977),c=t(40186),m=t(7849),x=t(32184),u=t(5516),h=t(92950),f=t(56079),p=t(52297),g=t(63602),j=t(35011),b=t(87687);function N(e){let{className:s,classNames:t,showOutsideDays:r=!0,...n}=e;return(0,a.jsx)(j.h,{showOutsideDays:r,className:(0,b.cn)("p-3",s),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,b.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,b.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:e=>{let{...s}=e;return(0,a.jsx)(p.A,{className:"h-4 w-4"})},IconRight:e=>{let{...s}=e;return(0,a.jsx)(g.A,{className:"h-4 w-4"})}},...n})}N.displayName="Calendar";var y=t(43480);let v=y.bL,w=y.l9,k=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:l=4,...n}=e;return(0,a.jsx)(y.ZL,{children:(0,a.jsx)(y.UC,{ref:s,align:r,sideOffset:l,className:(0,b.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})});k.displayName=y.UC.displayName;var _=t(45904),S=t(96939);let T=S.Kq,A=S.bL,C=S.l9,M=r.forwardRef((e,s)=>{let{className:t,sideOffset:r=4,...l}=e;return(0,a.jsx)(S.UC,{ref:s,sideOffset:r,className:(0,b.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})});M.displayName=S.UC.displayName;var L=t(54507),R=t(25192),P=t(97938),D=t(60118);function E(e){let{open:s,onOpenChange:t,tokenCount:n}=e,[i,o]=(0,r.useState)(null),[m,u]=(0,r.useState)(!1),[h,f]=(0,r.useState)(null),p=async()=>{u(!0),f(null);try{let e=await L.f.getPricingTable();e.success&&e.data?o(e.data):f(e.message||"获取计费配置失败")}catch(e){f("获取计费配置失败")}u(!1)};(0,r.useEffect)(()=>{s&&p()},[s]);let g=()=>i&&void 0!==n?Math.floor(n/i.token_threshold):0,j=()=>i&&void 0!==n?n%i.token_threshold:0;return(0,a.jsx)(R.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(R.Cf,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)(R.c7,{children:[(0,a.jsxs)(R.L3,{className:"flex items-center gap-2",children:[(0,a.jsx)(P.A,{className:"h-5 w-5 text-blue-500"}),"累计Token计费配置"]}),(0,a.jsx)(R.rr,{children:"基于累计加权Token的计费方式，避免小额token也扣费的问题"})]}),m?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(x.A,{className:"h-6 w-6 animate-spin mr-2"}),(0,a.jsx)("span",{children:"加载中..."})]}):h?(0,a.jsx)(c.Fc,{variant:"destructive",children:(0,a.jsx)(c.TN,{children:h})}):i?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(c.Fc,{children:[(0,a.jsx)(D.A,{className:"h-4 w-4"}),(0,a.jsxs)(c.TN,{children:[i.description,void 0!==n&&(0,a.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,a.jsx)("div",{className:"font-medium",children:"当前Token使用情况:"}),(0,a.jsxs)("div",{className:"text-sm space-y-1",children:[(0,a.jsxs)("div",{children:["总加权Token: ",(0,a.jsx)("span",{className:"text-blue-600 font-mono",children:n.toLocaleString()})]}),(0,a.jsxs)("div",{children:["可扣费次数: ",(0,a.jsx)("span",{className:"text-green-600 font-mono",children:g()})," 次"]}),(0,a.jsxs)("div",{children:["总扣费积分: ",(0,a.jsx)("span",{className:"text-red-600 font-mono",children:g()*i.points_per_threshold})," 积分"]}),(0,a.jsxs)("div",{children:["累计余量: ",(0,a.jsx)("span",{className:"text-orange-600 font-mono",children:j()})," Token"]})]})]})]})]}),(0,a.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,a.jsxs)(d.XI,{children:[(0,a.jsx)(d.A0,{children:(0,a.jsxs)(d.Hj,{className:"bg-gray-50 dark:bg-gray-800",children:[(0,a.jsx)(d.nd,{className:"font-semibold",children:"配置项"}),(0,a.jsx)(d.nd,{className:"font-semibold",children:"配置值"}),(0,a.jsx)(d.nd,{className:"font-semibold",children:"说明"})]})}),(0,a.jsxs)(d.BF,{children:[(0,a.jsxs)(d.Hj,{children:[(0,a.jsx)(d.nA,{className:"font-medium",children:"计费阈值"}),(0,a.jsxs)(d.nA,{className:"font-mono text-blue-600",children:[i.token_threshold.toLocaleString()," Token"]}),(0,a.jsx)(d.nA,{className:"text-sm text-gray-600 dark:text-gray-400",children:"累计达到此Token数量时进行扣费"})]}),(0,a.jsxs)(d.Hj,{children:[(0,a.jsx)(d.nA,{className:"font-medium",children:"每阈值积分"}),(0,a.jsxs)(d.nA,{className:"font-mono text-red-600",children:[i.points_per_threshold," 积分"]}),(0,a.jsx)(d.nA,{className:"text-sm text-gray-600 dark:text-gray-400",children:"每达到一个阈值扣除的积分数量"})]})]})]})}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"计费说明："}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,a.jsx)("li",{children:"系统累计用户的加权Token使用量"}),(0,a.jsx)("li",{children:"加权Token = 输入Token\xd7输入倍率 + 输出Token\xd7输出倍率 + 缓存Token\xd7缓存倍率"}),(0,a.jsx)("li",{children:"当累计Token达到阈值时，扣除相应积分并重置计数器"}),(0,a.jsx)("li",{children:"解决了小额Token也扣费的问题，只有累计到一定量才扣费"}),(0,a.jsx)("li",{children:"支持一次性扣除多个阈值的积分（如累计10000token时扣除2积分）"})]})]}),void 0!==n&&(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"\uD83D\uDCCA 当前计费示例"}),(0,a.jsxs)("div",{className:"font-mono text-sm space-y-1",children:[(0,a.jsxs)("div",{children:["当前累计: ",n.toLocaleString()," Token"]}),(0,a.jsxs)("div",{children:["扣费次数: ",n.toLocaleString()," \xf7 ",i.token_threshold.toLocaleString()," = ",g()," 次"]}),(0,a.jsxs)("div",{children:["扣费积分: ",g()," \xd7 ",i.points_per_threshold," = ",(0,a.jsxs)("span",{className:"text-red-600 font-bold",children:[g()*i.points_per_threshold," 积分"]})]}),(0,a.jsxs)("div",{children:["剩余累计: ",n.toLocaleString()," % ",i.token_threshold.toLocaleString()," = ",(0,a.jsxs)("span",{className:"text-orange-600",children:[j()," Token"]})]})]})]})]}):null,(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(l.$,{variant:"outline",onClick:()=>t(!1),children:"关闭"})})]})})}var z=t(56752);function F(){var e,s,t;let[j,y]=(0,r.useState)(!0),[S,R]=(0,r.useState)(null),[P,D]=(0,r.useState)([]),[F,U]=(0,r.useState)(null),[H,G]=(0,r.useState)(!1),[B,I]=(0,r.useState)(void 0),[O,$]=(0,r.useState)(5e3),[V,q]=(0,r.useState)(1),[J,X]=(0,r.useState)(()=>{let e=new Date;return e.setDate(e.getDate()-7),e}),[Z,Y]=(0,r.useState)(()=>new Date),[W,K]=(0,r.useState)(1),[Q,ee]=(0,r.useState)(1),[es,et]=(0,r.useState)(10),[ea,er]=(0,r.useState)(null),el=async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;y(!0),er(null);try{let[a,r,l]=await Promise.all([L.f.getBalance(),L.f.getUsageHistory({start_date:e?(0,z.GP)(e,"yyyy-MM-dd"):(0,z.GP)(J,"yyyy-MM-dd"),end_date:s?(0,z.GP)(s,"yyyy-MM-dd"):(0,z.GP)(Z,"yyyy-MM-dd"),page:t,page_size:es}),L.f.getPricingTable()]);if(a.success&&a.data&&R(a.data),l.success&&l.data&&($(l.data.token_threshold),q(l.data.points_per_threshold)),r.success&&r.data){let e=r.data.history||[];D(e),K(r.data.currentPage||1),ee(r.data.totalPages||1)}}catch(e){er("加载积分数据失败")}y(!1)},en=e=>{K(e),el(J,Z,e)},ed=e=>{U(e===F?null:e)},ei=async(e,s,t,a)=>{y(!0),er(null);try{let[r,l]=await Promise.all([L.f.getBalance(),L.f.getUsageHistory({start_date:(0,z.GP)(e,"yyyy-MM-dd"),end_date:(0,z.GP)(s,"yyyy-MM-dd"),page:t,page_size:a})]);if(r.success&&r.data&&R(r.data),l.success&&l.data){let e=l.data.history||[];D(e),K(l.data.currentPage||1),ee(l.data.totalPages||1)}}catch(e){er("加载积分数据失败")}y(!1)};(0,r.useEffect)(()=>{el()},[]),Array.isArray(P)&&P.reduce((e,s)=>e+Math.round(100*Math.abs(s.amount))/100,0);let eo=Array.isArray(P)?new Set(P.map(e=>e.relatedModel)).size:0;return(0,a.jsxs)("div",{className:"space-y-6",children:[ea&&(0,a.jsxs)(c.Fc,{variant:"destructive",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),(0,a.jsx)(c.TN,{children:ea})]}),(0,a.jsx)(n.Zp,{className:"shadow-lg bg-card text-card-foreground border-border",children:(0,a.jsx)(n.Wu,{className:"pt-6 px-6",children:j?(0,a.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,a.jsx)(x.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-3 text-lg",children:"加载中..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,a.jsxs)(o.E,{className:"bg-red-500 text-white hover:bg-red-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:((null==S?void 0:S.used_points)||0).toLocaleString()}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"已消耗"})]}),(0,a.jsxs)(o.E,{className:"bg-sky-500 text-white hover:bg-sky-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:(null==S?void 0:null===(e=S.available_points)||void 0===e?void 0:e.toLocaleString())||0}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"可用积分"})]}),(0,a.jsxs)(o.E,{className:"bg-green-500 text-white hover:bg-green-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:eo}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"使用模型"})]}),(0,a.jsxs)(o.E,{className:"bg-purple-500 text-white hover:bg-purple-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:(null==S?void 0:null===(s=S.free_model_usage_count)||void 0===s?void 0:s.toLocaleString())||0}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"免费调用"})]}),(0,a.jsxs)(o.E,{className:"bg-orange-500 text-white hover:bg-orange-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:(null==S?void 0:null===(t=S.accumulated_tokens)||void 0===t?void 0:t.toLocaleString())||0}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"累计Token"})]}),((null==S?void 0:S.expired_points)||0)>0&&(0,a.jsxs)(o.E,{className:"bg-orange-500 text-white hover:bg-orange-600 px-2.5 py-1.5 shadow-sm",children:[(0,a.jsx)("span",{className:"font-semibold",children:((null==S?void 0:S.expired_points)||0).toLocaleString()}),(0,a.jsx)("span",{className:"ml-1 text-xs opacity-90",children:"已过期"})]})]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mb-4 px-1",children:"仅显示当前有效订阅的积分数据"}),S&&(0,a.jsxs)("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-lg p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"累计Token进度"}),(0,a.jsxs)("span",{className:"text-xs text-orange-600 dark:text-orange-300",children:["距离下次扣费还需 ",Math.max(0,O-S.accumulated_tokens%O).toLocaleString()," Token"]})]}),(0,a.jsx)("div",{className:"w-full bg-orange-200 dark:bg-orange-800 rounded-full h-2 mb-2",children:(0,a.jsx)("div",{className:"bg-orange-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(Math.min(100,S.accumulated_tokens%O/O*100),"%")}})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-orange-700 dark:text-orange-300",children:[(0,a.jsxs)("span",{children:[(S.accumulated_tokens%O).toLocaleString()," / ",O.toLocaleString()," Token"]}),(0,a.jsxs)("span",{children:[(S.accumulated_tokens%O/O*100).toFixed(1),"%"]})]})]}),(0,a.jsx)(i.w,{className:"my-4"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"开始时间:"}),(0,a.jsx)("div",{className:"relative flex-1",children:(0,a.jsxs)(v,{children:[(0,a.jsx)(w,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",className:(0,b.cn)("w-full justify-start text-left font-normal",!J&&"text-muted-foreground"),children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),J?(0,z.GP)(J,"yyyy-MM-dd"):(0,a.jsx)("span",{children:"选择开始日期"})]})}),(0,a.jsx)(k,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(N,{mode:"single",selected:J,onSelect:e=>e&&X(e),initialFocus:!0})})]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-1",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"结束时间:"}),(0,a.jsx)("div",{className:"relative flex-1",children:(0,a.jsxs)(v,{children:[(0,a.jsx)(w,{asChild:!0,children:(0,a.jsxs)(l.$,{variant:"outline",className:(0,b.cn)("w-full justify-start text-left font-normal",!Z&&"text-muted-foreground"),children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),Z?(0,z.GP)(Z,"yyyy-MM-dd"):(0,a.jsx)("span",{children:"选择结束日期"})]})}),(0,a.jsx)(k,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(N,{mode:"single",selected:Z,onSelect:e=>e&&Y(e),initialFocus:!0})})]})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(l.$,{size:"sm",className:"bg-sky-500 hover:bg-sky-600 text-white",onClick:()=>{K(1),el(J,Z,1)},children:[(0,a.jsx)(h.A,{className:"mr-1 h-4 w-4"})," 查询"]}),(0,a.jsxs)(l.$,{size:"sm",variant:"outline",className:"border-border",onClick:()=>{let e=new Date,s=new Date;s.setDate(s.getDate()-7),X(s),Y(e),K(1),el(s,e,1)},children:[(0,a.jsx)(f.A,{className:"mr-1 h-4 w-4"})," 重置"]})]})]}),(0,a.jsx)(i.w,{className:"my-4"}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)("div",{className:"overflow-auto",children:Array.isArray(P)&&P.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.XI,{children:[(0,a.jsx)(d.A0,{children:(0,a.jsxs)(d.Hj,{className:"border-border",children:[(0,a.jsx)(d.nd,{children:"日期"}),(0,a.jsx)(d.nd,{children:"模型"}),(0,a.jsx)(d.nd,{children:"Token使用"}),(0,a.jsx)(d.nd,{className:"text-right",children:"消耗积分"})]})}),(0,a.jsx)(d.BF,{children:P.map(e=>(0,a.jsxs)(r.Fragment,{children:[(0,a.jsxs)(d.Hj,{className:"border-border cursor-pointer transition-colors ".concat(F===e.id?"bg-sky-50 dark:bg-sky-900/20":"hover:bg-muted/50"),onClick:()=>ed(e.id),children:[(0,a.jsx)(d.nA,{className:"font-medium",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)(d.nA,{children:(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(o.E,{variant:"outline",className:"mr-2",children:e.relatedModel||"Unknown"})})}),(0,a.jsx)(d.nA,{children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[(0,a.jsx)(T,{delayDuration:0,children:(0,a.jsxs)(A,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsx)(o.E,{className:"bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-300 border-green-300",children:e.input_tokens.toLocaleString()})}),(0,a.jsx)(M,{children:(0,a.jsx)("p",{children:"输入Token"})})]})}),(0,a.jsx)(T,{delayDuration:0,children:(0,a.jsxs)(A,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsx)(o.E,{className:"bg-red-100 text-red-800 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-300 border-red-300",children:e.output_tokens.toLocaleString()})}),(0,a.jsx)(M,{children:(0,a.jsx)("p",{children:"输出Token"})})]})}),(e.total_cache_tokens||0)>0&&(0,a.jsx)(T,{delayDuration:0,children:(0,a.jsxs)(A,{children:[(0,a.jsx)(C,{asChild:!0,children:(0,a.jsx)(o.E,{className:"bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-300 border-blue-300",children:(e.total_cache_tokens||0).toLocaleString()})}),(0,a.jsx)(M,{children:(0,a.jsx)("p",{children:"缓存Token"})})]})})]})}),(0,a.jsx)(d.nA,{className:"text-right",children:(0,a.jsx)("div",{className:"flex items-center justify-end",children:1>Math.abs(e.amount)?(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium text-orange-600",children:Math.round(100*Math.abs(e.amount))/100}),(0,a.jsx)("div",{className:"text-xs text-orange-500",children:"进度积分 (非实际扣费，仅展示此次对话累计Token对应的进度)"})]}):(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-medium text-red-600",children:Math.round(100*Math.abs(e.amount))/100}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"积分"})]})})})]}),F===e.id&&e.billing_details&&(0,a.jsx)(d.Hj,{className:"bg-sky-50/50 dark:bg-sky-900/10",children:(0,a.jsx)(d.nA,{colSpan:4,className:"py-4",children:(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[(0,a.jsx)("h5",{className:"text-sm font-medium mb-3 text-blue-900 dark:text-blue-100",children:"\uD83D\uDCB0 累计Token计费详情"}),(0,a.jsx)("div",{className:"space-y-3 text-sm",children:(0,a.jsxs)("div",{className:"font-mono bg-white dark:bg-gray-800 p-3 rounded border",children:[(0,a.jsx)("div",{className:"text-gray-600 dark:text-gray-300 mb-2",children:"1. 加权Token计算:"}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("span",{className:"underline decoration-green-500 decoration-2",children:[e.input_tokens.toLocaleString(),"(输入) \xd7 ",e.billing_details.input_multiplier,"(输入倍率)"]})," + ",(e.total_cache_tokens||0)>0&&(0,a.jsxs)("span",{children:[(0,a.jsxs)("span",{className:"underline decoration-blue-500 decoration-2",children:[(e.total_cache_tokens||0).toLocaleString(),"(缓存) \xd7 ",e.billing_details.cache_multiplier,"(缓存倍率)"]})," + "]}),(0,a.jsxs)("span",{className:"underline decoration-red-500 decoration-2",children:[e.output_tokens.toLocaleString(),"(输出) \xd7 ",e.billing_details.output_multiplier,"(输出倍率)"]})," = ",(0,a.jsxs)("span",{className:"font-bold text-blue-600",children:[e.billing_details.total_weighted_tokens.toLocaleString(),"(加权Token)"]})," → ",(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-800 underline cursor-pointer",onClick:s=>{var t;s.stopPropagation(),I(Math.round((null===(t=e.billing_details)||void 0===t?void 0:t.total_weighted_tokens)||0)),G(!0)},children:"查计费表"})," → 扣费: ",1>Math.abs(e.amount)?(0,a.jsxs)("span",{className:"font-bold text-orange-600",children:["0 ",(0,a.jsxs)("span",{className:"text-gray-500",children:["(",Math.round(100*Math.abs(e.amount))/100,"进度积分)"]})]}):(0,a.jsxs)("span",{className:"font-bold text-red-600",children:[Math.round(100*Math.abs(e.amount))/100,"积分"]})]}),1>Math.abs(e.amount)&&(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"此次调用未触发扣费，Token已累计到您的账户"})]})})]})})})]},e.id))})]}),(Q>1||P.length>0)&&(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between flex-wrap gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["第 ",W," 页，共 ",Q," 页"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"每页显示:"}),(0,a.jsxs)(_.l6,{value:es.toString(),onValueChange:e=>{let s=parseInt(e);et(s),K(1),ei(J,Z,1,s)},children:[(0,a.jsx)(_.bq,{className:"w-20",children:(0,a.jsx)(_.yv,{})}),(0,a.jsx)(_.gC,{children:[10,20,40,100].map(e=>(0,a.jsx)(_.eb,{value:e.toString(),children:e},e))})]}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"条"})]})]}),Q>1&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>en(W-1),disabled:W<=1,children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),"上一页"]}),(0,a.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(Q,5)},(e,s)=>{let t;return t=Q<=5?s+1:W<=3?s+1:W>=Q-2?Q-4+s:W-2+s,(0,a.jsx)(l.$,{variant:W===t?"default":"outline",size:"sm",onClick:()=>en(t),className:"w-8 h-8 p-0",children:t},t)})}),(0,a.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>en(W+1),disabled:W>=Q,children:["下一页",(0,a.jsx)(g.A,{className:"h-4 w-4"})]})]})]})]}):(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"暂无使用记录"})})})})]})})}),(0,a.jsx)(E,{open:H,onOpenChange:G,tokenCount:B})]})}},25192:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>m,Es:()=>u,L3:()=>h,c7:()=>x,lG:()=>i,rr:()=>f});var a=t(58081),r=t(82149),l=t(18112),n=t(22522),d=t(87687);let i=l.bL;l.l9;let o=l.ZL;l.bm;let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hJ,{ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});c.displayName=l.hJ.displayName;let m=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(c,{}),(0,a.jsxs)(l.UC,{ref:s,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[r,(0,a.jsxs)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=l.UC.displayName;let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};x.displayName="DialogHeader";let u=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};u.displayName="DialogFooter";let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hE,{ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});h.displayName=l.hE.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...r})});f.displayName=l.VY.displayName},40186:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>i,TN:()=>c,XL:()=>o});var a=t(58081),r=t(82149),l=t(23484),n=t(87687);let d=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef((e,s)=>{let{className:t,variant:r,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,n.cn)(d({variant:r}),t),...l})});i.displayName="Alert";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",t),...r})});o.displayName="AlertTitle";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",t),...r})});c.displayName="AlertDescription"},45904:(e,s,t)=>{"use strict";t.d(s,{bq:()=>x,eb:()=>p,gC:()=>f,l6:()=>c,yv:()=>m});var a=t(58081),r=t(82149),l=t(17493),n=t(60392),d=t(56801),i=t(76722),o=t(87687);let c=l.bL;l.YJ;let m=l.WT,x=r.forwardRef((e,s)=>{let{className:t,children:r,...d}=e;return(0,a.jsxs)(l.l9,{ref:s,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...d,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=l.l9.displayName;let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.PP,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})});u.displayName=l.PP.displayName;let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wn,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let f=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...d}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:s,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...d,children:[(0,a.jsx)(u,{}),(0,a.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});f.displayName=l.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.JU,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=l.JU.displayName;let p=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(l.q7,{ref:s,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:r})]})});p.displayName=l.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wv,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=l.wv.displayName},54507:(e,s,t)=>{"use strict";t.d(s,{f:()=>r});var a=t(65900);let r={async getBalance(){try{let e=await a.E.get("/credits/balance");if(e.data&&e.data.balance){let s=e.data.balance,t={id:0,user_id:0,total_points:s.total||0,used_points:s.used||0,available_points:s.available||0,expired_points:s.expired||0,is_current_subscription:s.is_current_subscription||!1,free_model_usage_count:s.free_model_usage_count||0,checkin_points:s.checkin_points||0,admin_gift_points:s.admin_gift_points||0,accumulated_tokens:s.accumulated_tokens||0,auto_refill:s.auto_refill||void 0,updated_at:new Date().toISOString()};return{success:!0,data:t}}return{success:!0,data:e.data}}catch(t){var e,s;return console.error("获取积分余额失败:",t),{success:!1,message:(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)||"获取积分余额失败"}}},async getUsageHistory(e){try{let s=await a.E.get("/credits/history",{params:e});return{success:!0,data:s.data}}catch(e){var s,t;return console.error("获取积分使用历史失败:",e),{success:!1,message:(null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||"获取积分使用历史失败"}}},async getModelCosts(){try{let e=await a.E.get("/credits/model-costs");return{success:!0,data:e.data}}catch(t){var e,s;return console.error("获取模型价格失败:",t),{success:!1,message:(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)||"获取模型价格失败"}}},async getPricingTable(){try{let e=await a.E.get("/credits/pricing-table");return{success:!0,data:e.data}}catch(t){var e,s;return console.error("获取计费配置失败:",t),{success:!1,message:(null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)||"获取计费配置失败"}}}}},85977:(e,s,t)=>{"use strict";t.d(s,{E:()=>d});var a=t(58081);t(82149);var r=t(23484),l=t(87687);let n=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,l.cn)(n({variant:t}),s),...r})}}},e=>{var s=s=>e(e.s=s);e.O(0,[590,807,976,191,737,953,892,316,271,497,954,358],()=>s(4523)),_N_E=e.O()}]);