(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[662],{13895:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});let a=(0,r(51018).A)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]])},29621:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>f});var a=r(58081),t=r(82149),l=r(54271),d=r(5160),n=r(86810),o=r(80900),i=r(57890),c=r(34165),u=r(13895),m=r(83585);let x=(0,r(51018).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);var h=r(32706),p=r(6314),v=r(65900);function f(){let{user:e,logout:s}=(0,h.A)(),[r,f]=(0,t.useState)(!1),[g,b]=(0,t.useState)(""),[y,j]=(0,t.useState)(""),[w,N]=(0,t.useState)(!1),[k,R]=(0,t.useState)(0),[S,A]=(0,t.useState)(!1),[_,C]=(0,t.useState)(!1),[E,F]=(0,t.useState)(""),[J,L]=(0,t.useState)(""),[T,I]=(0,t.useState)(""),[M,B]=(0,t.useState)(""),[D,Z]=(0,t.useState)(!1),[$,O]=(0,t.useState)(0),[P,W]=(0,t.useState)(!1),[q,z]=(0,t.useState)(""),G=async s=>{if(!s.trim()){A(!1),F("");return}if(s===(null==e?void 0:e.username)){A(!1),F("新用户名不能与当前用户名相同");return}try{C(!0),F(""),await v.E.post("/auth/check-username",{username:s}),A(!0),F("")}catch(e){var r,a;A(!1),F((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"用户名不可用")}finally{C(!1)}},H=()=>{if(!J){W(!1),z("");return}if(J.length<6){W(!1),z("密码长度至少为6位");return}if(J!==T){W(!1),z("新密码和确认密码不匹配");return}W(!0),z("")};(0,t.useEffect)(()=>{let e=setTimeout(()=>{g&&G(g)},500);return()=>clearTimeout(e)},[g,null==e?void 0:e.username]),(0,t.useEffect)(()=>{H()},[J,T]);let U=async()=>{if(!S){p.oR.error("请输入有效的用户名");return}try{f(!0),await v.E.post("/auth/send-verification-code-settings",{type:"change_username",new_username:g}),N(!0),R(60),p.oR.success("验证码已发送到您的邮箱");let e=setInterval(()=>{R(s=>s<=1?(clearInterval(e),N(!1),0):s-1)},1e3)}catch(r){var e,s;p.oR.error((null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"操作失败")}finally{f(!1)}},V=async()=>{if(!P){p.oR.error("请输入有效的密码");return}try{f(!0),await v.E.post("/auth/send-verification-code-settings",{type:"change_password"}),Z(!0),O(60),p.oR.success("验证码已发送到您的邮箱");let e=setInterval(()=>{O(s=>s<=1?(clearInterval(e),Z(!1),0):s-1)},1e3)}catch(r){var e,s;p.oR.error((null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"发送验证码失败")}finally{f(!1)}},K=async()=>{if(!y){p.oR.error("请输入验证码");return}try{f(!0),await v.E.post("/auth/change-username",{new_username:g,verification_code:y}),p.oR.success("用户名修改成功"),b(""),j(""),N(!1),R(0),window.location.reload()}catch(r){var e,s;p.oR.error((null===(s=r.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.message)||"用户名修改失败")}finally{f(!1)}},Q=async()=>{if(!M){p.oR.error("请输入验证码");return}try{f(!0),await v.E.post("/auth/change-password",{new_password:J,verification_code:M}),p.oR.success("密码修改成功，请重新登录"),L(""),I(""),B(""),Z(!1),O(0),setTimeout(()=>{s()},3e3)}catch(s){var e,r;p.oR.error((null===(r=s.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||"密码修改失败")}finally{f(!1)}};return(0,a.jsx)(l.DashboardLayout,{children:(0,a.jsxs)("div",{className:"space-y-8 max-w-3xl mx-auto",children:[(0,a.jsxs)(n.Zp,{className:"shadow-lg bg-card text-card-foreground border-border",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(c.A,{className:"h-6 w-6 text-sky-500 dark:text-sky-400"}),(0,a.jsx)(n.ZB,{children:"修改用户名"})]}),(0,a.jsx)(n.BT,{children:"修改您的用户名需要邮箱验证。"})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.J,{htmlFor:"new-username",children:"新用户名"}),(0,a.jsx)(o.p,{id:"new-username",value:g,onChange:e=>b(e.target.value),placeholder:"当前用户名: ".concat((null==e?void 0:e.username)||""),className:"bg-input border-border placeholder:text-muted-foreground ".concat(E?"border-red-500":S&&g?"border-green-500":"")}),_&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"检查中..."}),E&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:E}),S&&g&&!E&&(0,a.jsx)("p",{className:"text-sm text-green-600",children:"用户名可用"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.J,{htmlFor:"username-code",children:"验证码"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.p,{id:"username-code",value:y,onChange:e=>j(e.target.value),placeholder:"请输入邮箱验证码",className:"bg-input border-border placeholder:text-muted-foreground"}),(0,a.jsx)(d.$,{variant:"outline",onClick:U,disabled:r||w||!S||_||!g.trim(),className:"min-w-32 shrink-0",children:w?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"h-4 w-4"}),k,"s"]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"发送验证码"]})})]})]})]}),(0,a.jsx)(n.wL,{className:"border-t border-border pt-4",children:(0,a.jsx)(d.$,{onClick:K,disabled:r||!y,className:"bg-sky-500 hover:bg-sky-600 text-primary-foreground",children:r?"修改中...":"确认修改"})})]}),(0,a.jsxs)(n.Zp,{className:"shadow-lg bg-card text-card-foreground border-border",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(x,{className:"h-6 w-6 text-sky-500 dark:text-sky-400"}),(0,a.jsx)(n.ZB,{children:"修改密码"})]}),(0,a.jsx)(n.BT,{children:"修改您的密码需要邮箱验证，定期更新密码可保护账户安全。"})]}),(0,a.jsxs)(n.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.J,{htmlFor:"new-password",children:"新密码"}),(0,a.jsx)(o.p,{id:"new-password",type:"password",value:J,onChange:e=>L(e.target.value),placeholder:"请输入新密码（至少6位）",className:"bg-input border-border placeholder:text-muted-foreground ".concat(q&&J?"border-red-500":P&&J?"border-green-500":"")})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.J,{htmlFor:"confirm-password",children:"确认新密码"}),(0,a.jsx)(o.p,{id:"confirm-password",type:"password",value:T,onChange:e=>I(e.target.value),placeholder:"请再次输入新密码",className:"bg-input border-border placeholder:text-muted-foreground ".concat(q&&T?"border-red-500":P&&T?"border-green-500":"")}),q&&(J||T)&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:q}),P&&J&&T&&!q&&(0,a.jsx)("p",{className:"text-sm text-green-600",children:"密码设置有效"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(i.J,{htmlFor:"password-code",children:"验证码"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.p,{id:"password-code",value:M,onChange:e=>B(e.target.value),placeholder:"请输入邮箱验证码",className:"bg-input border-border placeholder:text-muted-foreground"}),(0,a.jsx)(d.$,{variant:"outline",onClick:V,disabled:r||D||!P||!J.trim()||!T.trim(),className:"min-w-32 shrink-0",children:D?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"h-4 w-4"}),$,"s"]}):(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),"发送验证码"]})})]})]})]}),(0,a.jsx)(n.wL,{className:"border-t border-border pt-4",children:(0,a.jsx)(d.$,{onClick:Q,disabled:r||!M,className:"bg-sky-500 hover:bg-sky-600 text-primary-foreground",children:r?"修改中...":"确认修改"})})]})]})})}},29716:(e,s,r)=>{"use strict";r.d(s,{b:()=>n});var a=r(82149),t=r(39217),l=r(58081),d=a.forwardRef((e,s)=>(0,l.jsx)(t.sG.label,{...e,ref:s,onMouseDown:s=>{var r;s.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));d.displayName="Label";var n=d},34165:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});let a=(0,r(51018).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},57890:(e,s,r)=>{"use strict";r.d(s,{J:()=>i});var a=r(58081),t=r(82149),l=r(29716),d=r(23484),n=r(87687);let o=(0,d.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),i=t.forwardRef((e,s)=>{let{className:r,...t}=e;return(0,a.jsx)(l.b,{ref:s,className:(0,n.cn)(o(),r),...t})});i.displayName=l.b.displayName},80900:(e,s,r)=>{"use strict";r.d(s,{p:()=>d});var a=r(58081),t=r(82149),l=r(87687);let d=t.forwardRef((e,s)=>{let{className:r,type:t,...d}=e;return(0,a.jsx)("input",{type:t,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...d})});d.displayName="Input"},83585:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});let a=(0,r(51018).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},88534:(e,s,r)=>{Promise.resolve().then(r.bind(r,29621))}},e=>{var s=s=>e(e.s=s);e.O(0,[590,807,976,191,314,316,271,497,954,358],()=>s(88534)),_N_E=e.O()}]);