(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{3133:(e,t,r)=>{"use strict";r.d(t,{Gq:()=>i,J2:()=>a,Ro:()=>u,Sr:()=>m,bS:()=>c,e:()=>d,iD:()=>n,rj:()=>o,ug:()=>l});var s=r(65900);let a=async e=>{try{return(await s.E.post("/auth/send-verification-code",e)).data}catch(e){var t,r;return console.error("发送验证码失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"发送验证码失败，请稍后再试"}}},o=async e=>{try{return(await s.E.post("/auth/register-with-code",e)).data}catch(e){var t,r;return console.error("注册请求失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"注册失败，请稍后再试"}}},n=async e=>{try{return(await s.E.post("/auth/login",e)).data}catch(e){var t,r;return console.error("登录请求失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"邮箱或密码错误"}}},l=async()=>{try{let e=await s.E.get("/auth/user");if(e.data&&e.data.user)return{success:!0,user:e.data.user};return{success:!1,message:"用户信息格式错误"}}catch(r){var e,t;return console.error("获取用户信息失败:",r),{success:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"获取用户信息失败"}}},i=async e=>{try{let t=await s.E.post("/sso/authorize",{client_id:e.client_id,redirect_uri:e.redirect_uri,state:e.state,device_flow:e.device_flow||!1});return{success:!0,...t.data}}catch(e){var t,r,a,o;return console.error("OAuth授权失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||(null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.error)||"授权失败"}}},c=async e=>{try{return(await s.E.post("/auth/email-auth",e)).data}catch(e){var t,r;return console.error("邮箱验证码认证失败:",e),{success:!1,message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"认证失败，请稍后再试"}}},u=async e=>{try{return(await s.E.post("/auth/check-email",e)).data}catch(e){var t,r;return console.error("检查邮箱失败:",e),{success:!1,user_exists:!1,action_type:"register",message:(null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.message)||"检查邮箱失败，请稍后再试"}}},d=async()=>{try{return(await s.E.get("/oauth/linux-do/config")).data}catch(r){var e,t;return console.error("获取Linux Do配置失败:",r),{success:!1,available:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"获取配置失败"}}},m=async()=>{try{return(await s.E.get("/oauth/linux-do/authorize")).data}catch(r){var e,t;return console.error("生成Linux Do授权URL失败:",r),{success:!1,message:(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"生成授权URL失败"}}}},6146:()=>{},32706:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>i});var s=r(58081),a=r(82149),o=r(3133),n=r(19651);let l=(0,a.createContext)({user:null,isAuthenticated:!1,isLoading:!0,login:()=>{},logout:()=>{},refreshUserInfo:async()=>{}}),i=e=>{let{children:t}=e;(0,a.useId)();let[r,i]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),[d,m]=(0,a.useState)(!1),h=(0,n.useRouter)(),g=()=>{localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null),h.push("/login")},v=async()=>{try{u(!0);let e=await (0,o.ug)();if(e.success&&e.user)i(e.user),localStorage.setItem("user_data",JSON.stringify(e.user));else throw Error("获取用户信息失败")}catch(e){console.error("刷新用户信息失败:",e),g()}finally{u(!1)}};return(0,a.useEffect)(()=>{!d&&(async()=>{u(!0);try{let e=localStorage.getItem("auth_token"),t=localStorage.getItem("user_data");if(e&&t){i(JSON.parse(t));let e=await (0,o.ug)();e.success&&e.user?(i(e.user),localStorage.setItem("user_data",JSON.stringify(e.user))):(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null))}}catch(e){console.error("初始化认证状态失败:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),i(null)}finally{u(!1),m(!0)}})()},[d]),(0,a.useEffect)(()=>{},[]),(0,s.jsx)(l.Provider,{value:{user:r,isAuthenticated:!!r,isLoading:c,login:(e,t)=>{localStorage.setItem("auth_token",e),localStorage.setItem("user_data",JSON.stringify(t)),i(t)},logout:g,refreshUserInfo:v},children:t})},c=()=>(0,a.useContext)(l)},36174:(e,t,r)=>{"use strict";r.d(t,{D:()=>u,N:()=>d});var s=r(82149),a=(e,t,r,s,a,o,n,l)=>{let i=document.documentElement,c=["light","dark"];function u(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,s=r&&o?a.map(e=>o[e]||e):a;r?(i.classList.remove(...s),i.classList.add(o&&o[t]?o[t]:t)):i.setAttribute(e,t)}),r=t,l&&c.includes(r)&&(i.style.colorScheme=r)}if(s)u(s);else try{let e=localStorage.getItem(t)||r,s=n&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;u(s)}catch(e){}},o=["light","dark"],n="(prefers-color-scheme: dark)",l="undefined"==typeof window,i=s.createContext(void 0),c={setTheme:e=>{},themes:[]},u=()=>{var e;return null!=(e=s.useContext(i))?e:c},d=e=>s.useContext(i)?s.createElement(s.Fragment,null,e.children):s.createElement(h,{...e}),m=["light","dark"],h=e=>{let{forcedTheme:t,disableTransitionOnChange:r=!1,enableSystem:a=!0,enableColorScheme:l=!0,storageKey:c="theme",themes:u=m,defaultTheme:d=a?"system":"light",attribute:h="data-theme",value:f,children:w,nonce:b,scriptProps:S}=e,[E,_]=s.useState(()=>v(c,d)),[k,x]=s.useState(()=>"system"===E?y():E),I=f?Object.values(f):u,C=s.useCallback(e=>{let t=e;if(!t)return;"system"===e&&a&&(t=y());let s=f?f[t]:t,n=r?p(b):null,i=document.documentElement,c=e=>{"class"===e?(i.classList.remove(...I),s&&i.classList.add(s)):e.startsWith("data-")&&(s?i.setAttribute(e,s):i.removeAttribute(e))};if(Array.isArray(h)?h.forEach(c):c(h),l){let e=o.includes(d)?d:null,r=o.includes(t)?t:e;i.style.colorScheme=r}null==n||n()},[b]),A=s.useCallback(e=>{let t="function"==typeof e?e(E):e;_(t);try{localStorage.setItem(c,t)}catch(e){}},[E]),T=s.useCallback(e=>{x(y(e)),"system"===E&&a&&!t&&C("system")},[E,t]);s.useEffect(()=>{let e=window.matchMedia(n);return e.addListener(T),T(e),()=>e.removeListener(T)},[T]),s.useEffect(()=>{let e=e=>{e.key===c&&(e.newValue?_(e.newValue):A(d))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[A]),s.useEffect(()=>{C(null!=t?t:E)},[t,E]);let j=s.useMemo(()=>({theme:E,setTheme:A,forcedTheme:t,resolvedTheme:"system"===E?k:E,themes:a?[...u,"system"]:u,systemTheme:a?k:void 0}),[E,A,t,k,a,u]);return s.createElement(i.Provider,{value:j},s.createElement(g,{forcedTheme:t,storageKey:c,attribute:h,enableSystem:a,enableColorScheme:l,defaultTheme:d,value:f,themes:u,nonce:b,scriptProps:S}),w)},g=s.memo(e=>{let{forcedTheme:t,storageKey:r,attribute:o,enableSystem:n,enableColorScheme:l,defaultTheme:i,value:c,themes:u,nonce:d,scriptProps:m}=e,h=JSON.stringify([o,r,i,t,u,c,n,l]).slice(1,-1);return s.createElement("script",{...m,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?d:"",dangerouslySetInnerHTML:{__html:"(".concat(a.toString(),")(").concat(h,")")}})}),v=(e,t)=>{let r;if(!l){try{r=localStorage.getItem(e)||void 0}catch(e){}return r||t}},p=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},y=e=>(e||(e=window.matchMedia(n)),e.matches?"dark":"light")},46092:(e,t,r)=>{"use strict";r.d(t,{AuthGuard:()=>u});var s=r(58081),a=r(82149),o=r(19651),n=r(32706),l=r(87687);function i(e){let{size:t="md",className:r}=e;return(0,s.jsx)("div",{className:(0,l.cn)("animate-spin rounded-full border-solid border-t-transparent border-sky-500",{sm:"h-4 w-4 border-2",md:"h-8 w-8 border-3",lg:"h-12 w-12 border-4"}[t],r)})}let c=["/login","/register/oauth-complete"];function u(e){let{children:t}=e,{isAuthenticated:r,isLoading:l}=(0,n.A)(),u=(0,o.usePathname)(),d=(0,o.useRouter)(),m=c.includes(u);return((0,a.useEffect)(()=>{l||m||r||d.replace("/login?redirect=".concat(encodeURIComponent(u))),!l&&m&&r&&d.replace("/")},[l,r,m,u,d]),l)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(i,{size:"lg"})}):m||r?(0,s.jsx)(s.Fragment,{children:t}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(i,{size:"lg"})})}},47549:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6146,23)),Promise.resolve().then(r.bind(r,46092)),Promise.resolve().then(r.bind(r,51168)),Promise.resolve().then(r.bind(r,71539)),Promise.resolve().then(r.bind(r,32706))},51168:(e,t,r)=>{"use strict";r.d(t,{ThemeProvider:()=>o});var s=r(58081);r(82149);var a=r(36174);function o(e){let{children:t,...r}=e;return(0,s.jsx)(a.N,{...r,children:t})}},65900:(e,t,r)=>{"use strict";r.d(t,{E:()=>s});let s=r(26807).A.create({baseURL:(()=>{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://localhost:9998/api":"www.duckcode.top"===e?"https://api.duckcode.top/api":"/api"})(),timeout:3e5,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{{let t=localStorage.getItem("auth_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e))),s.interceptors.response.use(e=>e,e=>{let{response:t}=e;return t&&401===t.status&&(console.warn("登录已过期，请重新登录"),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.pathname.includes("/login")||(window.location.href="/login")),Promise.reject(e)})},71539:(e,t,r)=>{"use strict";r.d(t,{Toaster:()=>n});var s=r(58081),a=r(36174),o=r(6314);let n=e=>{let{...t}=e,{theme:r="system"}=(0,a.D)();return(0,s.jsx)(o.l$,{theme:r,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})}},87687:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var s=r(76522),a=r(14483);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[979,590,807,314,497,954,358],()=>t(47549)),_N_E=e.O()}]);