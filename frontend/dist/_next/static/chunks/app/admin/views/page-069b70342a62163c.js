(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[475],{42284:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>W});var i=t(58081),l=t(82149),a=t(54271),n=t(86810),r=t(85977),d=t(64317),c=t(24899),o=t(31348),x=t(58869),h=t(6618),m=t(27023),u=t(37283),j=t(76496),f=t(36791),v=t(6846),p=t(74341),g=t(32725),N=t(94142),b=t(2151),_=t(9754),w=t(32184),y=t(7849),L=t(90018),D=t(40712),F=t(21100),Z=t(41315),S=t(34578),k=t(35170);let B=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884D8","#82CA9D"];function W(){var e,s,t,W,R,A;let[E,K]=(0,l.useState)(null),[C,T]=(0,l.useState)(!0),[z,O]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{T(!0),O(null);try{let e=await k.E.getDashboard();e.success&&e.data?K(e.data):O(e.message||"获取数据看板失败")}catch(e){O("获取数据看板失败")}finally{T(!1)}})()},[]);let M=e=>{let s=e>=0,t=s?(0,i.jsx)(b.A,{className:"h-3 w-3"}):(0,i.jsx)(_.A,{className:"h-3 w-3"});return(0,i.jsxs)("div",{className:"flex items-center gap-1 text-xs ".concat(s?"text-green-600":"text-red-600"),children:[t,(0,i.jsxs)("span",{children:[Math.abs(e).toFixed(1),"%"]})]})},P=e=>({activation_code:"激活码",payment:"付费购买",daily_checkin:"每日签到",admin_gift:"管理员赠送"})[e]||e;return C?(0,i.jsx)(a.DashboardLayout,{children:(0,i.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(w.A,{className:"h-6 w-6 animate-spin"}),(0,i.jsx)("span",{children:"加载数据看板中..."})]})})}):z?(0,i.jsx)(a.DashboardLayout,{children:(0,i.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,i.jsx)(y.A,{className:"h-6 w-6"}),(0,i.jsx)("span",{children:z})]})})}):(0,i.jsx)(a.DashboardLayout,{children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold",children:"管理员数据看板"}),(0,i.jsxs)(r.E,{variant:"outline",children:["更新时间: ",E?new Date(E.generated_at).toLocaleString():"--"]})]}),(0,i.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(n.ZB,{className:"text-sm font-medium",children:"总用户数"}),(0,i.jsx)(L.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:(null==E?void 0:E.overview.total_users.toLocaleString())||0}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:["今日新增: ",(null==E?void 0:E.overview.today_new_users)||0]}),E&&M(E.overview.user_growth_rate)]})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(n.ZB,{className:"text-sm font-medium",children:"有效订阅用户"}),(0,i.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:(null==E?void 0:E.overview.active_subscription_users.toLocaleString())||0}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["订阅转化率: ",E&&E.overview.total_users>0?(E.overview.active_subscription_users/E.overview.total_users*100).toFixed(1):0,"%"]})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(n.ZB,{className:"text-sm font-medium",children:"活跃订阅数"}),(0,i.jsx)(F.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:(null==E?void 0:E.overview.total_subscriptions.toLocaleString())||0}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["人均订阅: ",E&&E.overview.active_subscription_users>0?(E.overview.total_subscriptions/E.overview.active_subscription_users).toFixed(1):0]})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,i.jsx)(n.ZB,{className:"text-sm font-medium",children:"今日积分消耗"}),(0,i.jsx)(Z.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.Wu,{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:(null==E?void 0:E.overview.today_points_used.toLocaleString())||0}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"环比昨日"}),E&&M(E.overview.points_growth_rate)]})]})]})]}),(0,i.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[(0,i.jsxs)(n.Zp,{className:"lg:col-span-1",children:[(0,i.jsx)(n.aR,{children:(0,i.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,i.jsx)(S.A,{className:"h-5 w-5"}),"积分总览"]})}),(0,i.jsx)(n.Wu,{className:"space-y-4",children:(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"总积分"}),(0,i.jsx)("span",{className:"font-semibold",children:(null==E?void 0:E.points_stats.total_points.toLocaleString())||0})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"已使用"}),(0,i.jsx)("span",{className:"font-semibold text-red-600",children:(null==E?void 0:E.points_stats.used_points.toLocaleString())||0})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"可用积分"}),(0,i.jsx)("span",{className:"font-semibold text-green-600",children:(null==E?void 0:E.points_stats.available_points.toLocaleString())||0})]}),E&&E.points_stats.total_points>0&&(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm mb-1",children:[(0,i.jsx)("span",{children:"使用率"}),(0,i.jsxs)("span",{children:[(E.points_stats.used_points/E.points_stats.total_points*100).toFixed(1),"%"]})]}),(0,i.jsx)(d.k,{value:E.points_stats.used_points/E.points_stats.total_points*100,className:"h-2"})]})]})})]}),(0,i.jsxs)(n.Zp,{className:"lg:col-span-2",children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsx)(n.ZB,{children:"订阅计划分布"}),(0,i.jsx)(n.BT,{children:"各订阅计划的用户数量分布"})]}),(0,i.jsx)(n.Wu,{children:(null==E?void 0:null===(e=E.distributions.subscription_plans)||void 0===e?void 0:e.length)?(0,i.jsx)(c.u,{width:"100%",height:200,children:(0,i.jsxs)(o.E,{data:E.distributions.subscription_plans,children:[(0,i.jsx)(x.d,{strokeDasharray:"3 3"}),(0,i.jsx)(h.W,{dataKey:"plan_name"}),(0,i.jsx)(m.h,{}),(0,i.jsx)(u.m,{}),(0,i.jsx)(j.y,{dataKey:"count",fill:"#8884d8"})]})}):(0,i.jsx)("div",{className:"flex items-center justify-center h-48 text-muted-foreground",children:"暂无数据"})})]})]}),(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsx)(n.ZB,{children:"用户注册趋势"}),(0,i.jsx)(n.BT,{children:"最近7天的用户注册情况"})]}),(0,i.jsx)(n.Wu,{children:(null==E?void 0:null===(s=E.trends.user_registration)||void 0===s?void 0:s.length)?(0,i.jsx)(c.u,{width:"100%",height:300,children:(0,i.jsxs)(f.b,{data:E.trends.user_registration,children:[(0,i.jsx)(x.d,{strokeDasharray:"3 3"}),(0,i.jsx)(h.W,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}),(0,i.jsx)(m.h,{}),(0,i.jsx)(u.m,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[e,"新增用户"]}),(0,i.jsx)(v.N,{type:"monotone",dataKey:"count",stroke:"#8884d8",strokeWidth:2,dot:{r:4}})]})}):(0,i.jsx)("div",{className:"flex items-center justify-center h-72 text-muted-foreground",children:"暂无数据"})})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsx)(n.ZB,{children:"积分使用趋势"}),(0,i.jsx)(n.BT,{children:"最近7天的积分消耗情况"})]}),(0,i.jsx)(n.Wu,{children:(null==E?void 0:null===(t=E.trends.points_usage)||void 0===t?void 0:t.length)?(0,i.jsx)(c.u,{width:"100%",height:300,children:(0,i.jsxs)(f.b,{data:E.trends.points_usage,children:[(0,i.jsx)(x.d,{strokeDasharray:"3 3"}),(0,i.jsx)(h.W,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}),(0,i.jsx)(m.h,{}),(0,i.jsx)(u.m,{labelFormatter:e=>new Date(e).toLocaleDateString(),formatter:e=>[e,"积分消耗"]}),(0,i.jsx)(v.N,{type:"monotone",dataKey:"count",stroke:"#82ca9d",strokeWidth:2,dot:{r:4}})]})}):(0,i.jsx)("div",{className:"flex items-center justify-center h-72 text-muted-foreground",children:"暂无数据"})})]})]}),(0,i.jsxs)(n.Zp,{children:[(0,i.jsxs)(n.aR,{children:[(0,i.jsx)(n.ZB,{children:"积分来源分布"}),(0,i.jsx)(n.BT,{children:"不同来源的积分数量和订阅数分布"})]}),(0,i.jsx)(n.Wu,{children:(null==E?void 0:null===(W=E.distributions.points_sources)||void 0===W?void 0:W.length)?(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium mb-4",children:"按订阅数量"}),(0,i.jsx)(c.u,{width:"100%",height:250,children:(0,i.jsxs)(p.r,{children:[(0,i.jsx)(g.F,{data:E.distributions.points_sources,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{source_type:s,count:t,percent:i}=e;return"".concat(P(s),": ").concat(t," (").concat((100*(i||0)).toFixed(0),"%)")},outerRadius:80,fill:"#8884d8",dataKey:"count",children:null===(R=E.distributions.points_sources)||void 0===R?void 0:R.map((e,s)=>(0,i.jsx)(N.f,{fill:B[s%B.length]},"cell-".concat(s)))}),(0,i.jsx)(u.m,{formatter:(e,s,t)=>[e,"订阅数"]})]})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium mb-4",children:"按积分数量"}),(0,i.jsx)(c.u,{width:"100%",height:250,children:(0,i.jsxs)(p.r,{children:[(0,i.jsx)(g.F,{data:E.distributions.points_sources,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{source_type:s,points:t,percent:i}=e;return"".concat(P(s),": ").concat(t.toLocaleString()," (").concat((100*(i||0)).toFixed(0),"%)")},outerRadius:80,fill:"#8884d8",dataKey:"points",children:null===(A=E.distributions.points_sources)||void 0===A?void 0:A.map((e,s)=>(0,i.jsx)(N.f,{fill:B[s%B.length]},"cell-".concat(s)))}),(0,i.jsx)(u.m,{formatter:(e,s,t)=>[e.toLocaleString(),"积分"]})]})})]})]}):(0,i.jsx)("div",{className:"flex items-center justify-center h-64 text-muted-foreground",children:"暂无数据"})})]})]})})}},64317:(e,s,t)=>{"use strict";t.d(s,{k:()=>r});var i=t(58081),l=t(82149),a=t(12023),n=t(87687);let r=l.forwardRef((e,s)=>{let{className:t,value:l,...r}=e;return(0,i.jsx)(a.bL,{ref:s,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:(0,i.jsx)(a.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});r.displayName=a.bL.displayName},87034:(e,s,t)=>{Promise.resolve().then(t.bind(t,42284))}},e=>{var s=s=>e(e.s=s);e.O(0,[590,807,976,191,164,316,271,608,497,954,358],()=>s(87034)),_N_E=e.O()}]);