(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38],{383:(e,s,a)=>{Promise.resolve().then(a.bind(a,2965))},2965:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>w});var t=a(58081),l=a(82149),n=a(54271),i=a(86810),r=a(5160),c=a(80900),d=a(57890),o=a(25192),m=a(4666),u=a(85977),x=a(7872),f=a(14604),p=a(46645),g=a(34578),h=a(68308),j=a(13577),N=a(22486),v=a(92950),b=a(21107),_=a(36703),y=a(6314),k=a(35170);function w(){let[e,s]=(0,l.useState)(!1),[a,w]=(0,l.useState)([]),[C,E]=(0,l.useState)(null),[S,O]=(0,l.useState)(!1),[A,J]=(0,l.useState)(""),L={api:{title:"API 配置",icon:p.A,color:"bg-blue-500",configs:["new_api_endpoint","new_api_key","degradation_api_key"]},billing:{title:"计费配置",icon:g.A,color:"bg-green-500",configs:["prompt_multiplier","completion_multiplier","cache_multiplier","token_threshold","points_per_threshold"]},checkin:{title:"签到配置",icon:h.A,color:"bg-purple-500",configs:["daily_checkin_enabled","daily_checkin_points","daily_checkin_validity_days","daily_checkin_multi_subscription_strategy"]},system:{title:"系统配置",icon:j.A,color:"bg-orange-500",configs:["free_models_list","model_redirect_map","model_multiplier_map","default_degradation_guaranteed","registration_plan_mapping"]}},R=(0,l.useCallback)(async()=>{s(!0);let e=await k.E.getSystemConfigs();e.success&&e.configs?w(Array.isArray(e.configs)?e.configs:[]):(w([]),y.oR.error("加载失败",{description:e.message})),s(!1)},[y.oR]);(0,l.useEffect)(()=>{R()},[R]);let D=async e=>{let s=await k.E.updateSystemConfig({config_key:e.config_key,config_value:e.config_value});s.success?(y.oR.success("更新成功"),O(!1),R()):y.oR.error("更新失败",{description:s.message})},z=a.filter(e=>e.config_key.toLowerCase().includes(A.toLowerCase())||e.description.toLowerCase().includes(A.toLowerCase())),T=e=>z.filter(s=>e.includes(s.config_key)),U=()=>{let e=Object.values(L).flatMap(e=>e.configs);return z.filter(s=>!e.includes(s.config_key))},$=e=>{let s=e.config_value;if("daily_checkin_enabled"===e.config_key)return(0,t.jsx)(u.E,{variant:"true"===s?"default":"secondary",children:"true"===s?"启用":"禁用"});if("free_models_list"===e.config_key)try{let e=JSON.parse(s);return(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:e.map((e,s)=>(0,t.jsx)(u.E,{variant:"outline",className:"text-xs",children:e},s))})}catch(e){return(0,t.jsx)("span",{className:"text-muted-foreground",children:"格式错误"})}if("registration_plan_mapping"===e.config_key)try{let e=JSON.parse(s);return(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.entries(e).map((e,s)=>{let[a,l]=e;return(0,t.jsxs)(u.E,{variant:-1===l?"secondary":"default",className:"text-xs",children:[a,": ",-1===l?"不赠送":"套餐".concat(l)]},s)})})}catch(e){return(0,t.jsx)("span",{className:"text-muted-foreground",children:"格式错误"})}if("model_redirect_map"===e.config_key)try{let e=JSON.parse(s),a=Object.entries(e);if(0===a.length)return(0,t.jsx)(u.E,{variant:"secondary",className:"text-xs",children:"未设置重定向"});return(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:a.map((e,s)=>{let[a,l]=e;return(0,t.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[a," → ",l]},s)})})}catch(e){return(0,t.jsx)("span",{className:"text-muted-foreground",children:"格式错误"})}if("model_multiplier_map"===e.config_key)try{let e=JSON.parse(s),a=Object.entries(e);if(0===a.length)return(0,t.jsx)(u.E,{variant:"secondary",className:"text-xs",children:"未设置模型倍率"});return(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:a.map((e,s)=>{let[a,l]=e;return(0,t.jsxs)(u.E,{variant:"outline",className:"text-xs",children:[a,": ",l,"\xd7"]},s)})})}catch(e){return(0,t.jsx)("span",{className:"text-muted-foreground",children:"格式错误"})}return(0,t.jsx)("span",{className:"font-mono text-sm",children:s})};return(0,t.jsx)(n.DashboardLayout,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"系统配置"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"管理和调整系统运行参数"})]}),(0,t.jsxs)(r.$,{onClick:R,variant:"outline",disabled:e,children:[(0,t.jsx)(N.A,{className:"w-4 h-4 mr-2 ".concat(e?"animate-spin":"")}),"刷新"]})]}),(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"pt-6",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(v.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(c.p,{placeholder:"搜索配置项...",value:A,onChange:e=>J(e.target.value),className:"pl-10"})]})})}),e?(0,t.jsx)(i.Zp,{children:(0,t.jsxs)(i.Wu,{className:"flex items-center justify-center py-8",children:[(0,t.jsx)(N.A,{className:"w-6 h-6 animate-spin mr-2"}),"加载中..."]})}):(0,t.jsx)(i.Zp,{children:(0,t.jsx)(i.Wu,{className:"pt-6",children:(0,t.jsxs)(f.tU,{defaultValue:"api",className:"space-y-6",children:[(0,t.jsxs)(f.j7,{className:"grid w-full grid-cols-5",children:[Object.entries(L).map(e=>{let[s,a]=e,l=a.icon,n=T(a.configs);return(0,t.jsxs)(f.Xi,{value:s,className:"flex items-center space-x-2",disabled:0===n.length,children:[(0,t.jsx)(l,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:a.title}),(0,t.jsx)("span",{className:"sm:hidden",children:a.title.split(" ")[0]}),n.length>0&&(0,t.jsx)(u.E,{variant:"secondary",className:"ml-1 text-xs",children:n.length})]},s)}),U().length>0&&(0,t.jsxs)(f.Xi,{value:"other",className:"flex items-center space-x-2",children:[(0,t.jsx)(b.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"其他"}),(0,t.jsx)(u.E,{variant:"secondary",className:"ml-1 text-xs",children:U().length})]})]}),Object.entries(L).map(e=>{let[s,a]=e,l=T(a.configs);if(0===l.length)return null;let n=a.icon;return(0,t.jsxs)(f.av,{value:s,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg ".concat(a.color),children:(0,t.jsx)(n,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:a.title}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[l.length," 个配置项"]})]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex items-center space-x-2 mb-1",children:(0,t.jsx)("h4",{className:"font-medium text-sm",children:e.config_key})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:$(e)})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.updated_at).toLocaleDateString()}),(0,t.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{E(e),O(!0)},children:(0,t.jsx)(_.A,{className:"w-4 h-4"})})]})]},e.id))})]},s)}),U().length>0&&(0,t.jsxs)(f.av,{value:"other",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-gray-500",children:(0,t.jsx)(b.A,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"其他配置"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[U().length," 个配置项"]})]})]}),(0,t.jsx)("div",{className:"grid gap-4",children:U().map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"flex items-center space-x-2 mb-1",children:(0,t.jsx)("h4",{className:"font-medium text-sm",children:e.config_key})}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),(0,t.jsx)("div",{className:"flex items-center space-x-2",children:$(e)})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 ml-4",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(e.updated_at).toLocaleDateString()}),(0,t.jsx)(r.$,{size:"sm",variant:"outline",onClick:()=>{E(e),O(!0)},children:(0,t.jsx)(_.A,{className:"w-4 h-4"})})]})]},e.id))})]})]})})}),(0,t.jsx)(o.lG,{open:S,onOpenChange:O,children:(0,t.jsxs)(o.Cf,{className:"max-w-2xl",children:[(0,t.jsxs)(o.c7,{children:[(0,t.jsxs)(o.L3,{className:"flex items-center space-x-2",children:[(0,t.jsx)(b.A,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"编辑配置"})]}),(0,t.jsxs)(o.rr,{children:['修改 "',null==C?void 0:C.config_key,'" 的配置值']})]}),C&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{className:"text-sm font-medium",children:"配置键"}),(0,t.jsx)(c.p,{value:C.config_key,disabled:!0,className:"font-mono text-sm bg-muted"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{className:"text-sm font-medium",children:"更新时间"}),(0,t.jsx)(c.p,{value:new Date(C.updated_at).toLocaleString(),disabled:!0,className:"text-sm bg-muted"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{className:"text-sm font-medium",children:"描述"}),(0,t.jsx)(c.p,{value:C.description,disabled:!0,className:"bg-muted"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.J,{className:"text-sm font-medium",children:"配置值"}),"daily_checkin_enabled"===C.config_key?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(x.d,{checked:"true"===C.config_value,onCheckedChange:e=>E({...C,config_value:e?"true":"false"})}),(0,t.jsx)("span",{children:"true"===C.config_value?"启用":"禁用"})]}):"free_models_list"===C.config_key?(0,t.jsx)(m.T,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),placeholder:'["model1", "model2"]',className:"font-mono text-sm",rows:3}):"registration_plan_mapping"===C.config_key?(0,t.jsx)(m.T,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),placeholder:'{"default": -1, "linux_do": 1, "github": 2}',className:"font-mono text-sm",rows:4}):"model_redirect_map"===C.config_key?(0,t.jsx)(m.T,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),placeholder:'{"claude-3-opus-20240229": "claude-3-5-sonnet-20241022", "claude-3-sonnet-20240229": "claude-3-5-haiku-20241022"}',className:"font-mono text-sm",rows:5}):"model_multiplier_map"===C.config_key?(0,t.jsx)(m.T,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),placeholder:'{"claude-3-opus-20240229": 2.0, "claude-3-5-sonnet-20241022": 1.5}',className:"font-mono text-sm",rows:5}):C.config_key.includes("description")||C.config_key.includes("strategy")?(0,t.jsx)(m.T,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),rows:2}):(0,t.jsx)(c.p,{value:C.config_value,onChange:e=>E({...C,config_value:e.target.value}),className:C.config_key.includes("api")?"font-mono":""}),"free_models_list"===C.config_key&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'格式：JSON 数组，例如 ["model1", "model2"]'}),"model_redirect_map"===C.config_key&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["格式：JSON 对象，例如 ",'{"原始模型": "目标模型"}',"，空对象 ","{}"," 表示不重定向"]}),"model_multiplier_map"===C.config_key&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["格式：JSON 对象，例如 ",'{"模型名": 倍率}',"，倍率为数值类型，空对象 ","{}"," 表示不应用额外倍率"]}),"registration_plan_mapping"===C.config_key&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["格式：JSON 对象，例如 ",'{"platform": planId}',"，-1 表示不赠送套餐"]}),C.config_key.includes("multiplier")&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"数值类型，支持小数"})]})]}),(0,t.jsxs)(o.Es,{children:[(0,t.jsx)(r.$,{variant:"outline",onClick:()=>O(!1),children:"取消"}),(0,t.jsx)(r.$,{onClick:()=>C&&D(C),disabled:!C,children:"保存更改"})]})]})})]})})}},4666:(e,s,a)=>{"use strict";a.d(s,{T:()=>i});var t=a(58081),l=a(82149),n=a(87687);let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...l})});i.displayName="Textarea"},7872:(e,s,a)=>{"use strict";a.d(s,{d:()=>r});var t=a(58081),l=a(82149),n=a(65636),i=a(87687);let r=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.bL,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...l,ref:s,children:(0,t.jsx)(n.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});r.displayName=n.bL.displayName},14604:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>d,av:()=>o,j7:()=>c,tU:()=>r});var t=a(58081),l=a(82149),n=a(42044),i=a(87687);let r=n.bL,c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.B8,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...l})});c.displayName=n.B8.displayName;let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.l9,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...l})});d.displayName=n.l9.displayName;let o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.UC,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...l})});o.displayName=n.UC.displayName},25192:(e,s,a)=>{"use strict";a.d(s,{Cf:()=>m,Es:()=>x,L3:()=>f,c7:()=>u,lG:()=>c,rr:()=>p});var t=a(58081),l=a(82149),n=a(18112),i=a(22522),r=a(87687);let c=n.bL;n.l9;let d=n.ZL;n.bm;let o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.hJ,{ref:s,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l})});o.displayName=n.hJ.displayName;let m=l.forwardRef((e,s)=>{let{className:a,children:l,...c}=e;return(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{}),(0,t.jsxs)(n.UC,{ref:s,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:[l,(0,t.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(i.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=n.UC.displayName;let u=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...a})};u.displayName="DialogHeader";let x=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,r.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};x.displayName="DialogFooter";let f=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.hE,{ref:s,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",a),...l})});f.displayName=n.hE.displayName;let p=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.VY,{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",a),...l})});p.displayName=n.VY.displayName},57890:(e,s,a)=>{"use strict";a.d(s,{J:()=>d});var t=a(58081),l=a(82149),n=a(29716),i=a(23484),r=a(87687);let c=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.b,{ref:s,className:(0,r.cn)(c(),a),...l})});d.displayName=n.b.displayName},80900:(e,s,a)=>{"use strict";a.d(s,{p:()=>i});var t=a(58081),l=a(82149),n=a(87687);let i=l.forwardRef((e,s)=>{let{className:a,type:l,...i}=e;return(0,t.jsx)("input",{type:l,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...i})});i.displayName="Input"}},e=>{var s=s=>e(e.s=s);e.O(0,[590,807,976,191,314,737,815,316,271,608,497,954,358],()=>s(383)),_N_E=e.O()}]);